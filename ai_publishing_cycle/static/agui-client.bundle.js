/*! For license information please see agui-client.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{JsonPatchError:()=>Mn,_areEquals:()=>Kn,applyOperation:()=>Fn,applyPatch:()=>Zn,applyReducer:()=>Vn,deepClone:()=>Dn,getValueByPointer:()=>Gn,validate:()=>$n,validator:()=>Hn});var n,r,s={};e.r(s),e.d(s,{compare:()=>Qn,generate:()=>qn,observe:()=>Wn,unobserve:()=>Jn}),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(n||(n={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(r||(r={}));const a=n.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),i=e=>{switch(typeof e){case"undefined":return a.undefined;case"string":return a.string;case"number":return Number.isNaN(e)?a.nan:a.number;case"boolean":return a.boolean;case"function":return a.function;case"bigint":return a.bigint;case"symbol":return a.symbol;case"object":return Array.isArray(e)?a.array:null===e?a.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?a.promise:"undefined"!=typeof Map&&e instanceof Map?a.map:"undefined"!=typeof Set&&e instanceof Set?a.set:"undefined"!=typeof Date&&e instanceof Date?a.date:a.object;default:return a.unknown}},o=n.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class u extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(r);else if("invalid_return_type"===s.code)r(s.returnTypeError);else if("invalid_arguments"===s.code)r(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,r=0;for(;r<s.path.length;){const n=s.path[r];r===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof u))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,n.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const r of this.issues)if(r.path.length>0){const n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}u.create=e=>new u(e);const l=(e,t)=>{let r;switch(e.code){case o.invalid_type:r=e.received===a.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case o.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,n.jsonStringifyReplacer)}`;break;case o.unrecognized_keys:r=`Unrecognized key(s) in object: ${n.joinValues(e.keys,", ")}`;break;case o.invalid_union:r="Invalid input";break;case o.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${n.joinValues(e.options)}`;break;case o.invalid_enum_value:r=`Invalid enum value. Expected ${n.joinValues(e.options)}, received '${e.received}'`;break;case o.invalid_arguments:r="Invalid function arguments";break;case o.invalid_return_type:r="Invalid function return type";break;case o.invalid_date:r="Invalid date";break;case o.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:n.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case o.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case o.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case o.custom:r="Invalid input";break;case o.invalid_intersection_types:r="Intersection results could not be merged";break;case o.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case o.not_finite:r="Number must be finite";break;default:r=t.defaultError,n.assertNever(e)}return{message:r}};let c=l;var d;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(d||(d={}));function f(e,t){const n=c,r=(e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,a=[...n,...s.path||[]],i={...s,path:a};if(void 0!==s.message)return{...s,path:a,message:s.message};let o="";const u=r.filter(e=>!!e).slice().reverse();for(const e of u)o=e(i,{data:t,defaultError:o}).message;return{...s,path:a,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===l?void 0:l].filter(e=>!!e)});e.common.issues.push(r)}class p{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return h;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,r=await e.value;n.push({key:t,value:r})}return p.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:s}=r;if("aborted"===t.status)return h;if("aborted"===s.status)return h;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"===t.value||void 0===s.value&&!r.alwaysSet||(n[t.value]=s.value)}return{status:e.value,value:n}}}const h=Object.freeze({status:"aborted"}),v=e=>({status:"dirty",value:e}),m=e=>({status:"valid",value:e}),g=e=>"aborted"===e.status,_=e=>"dirty"===e.status,b=e=>"valid"===e.status,y=e=>"undefined"!=typeof Promise&&e instanceof Promise;class E{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const T=(e,t)=>{if(b(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new u(e.common.issues);return this._error=t,this._error}}};function w(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(t,s)=>{const{message:a}=e;return"invalid_enum_value"===t.code?{message:a??s.defaultError}:void 0===s.data?{message:a??r??s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:a??n??s.defaultError}},description:s}}class S{get description(){return this._def.description}_getType(e){return i(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new p,ctx:{common:e.parent.common,data:e.data,parsedType:i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(y(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)},r=this._parseSync({data:e,path:n.path,parent:n});return T(n,r)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return b(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>b(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)},r=this._parse({data:e,path:n.path,parent:n}),s=await(y(r)?r:Promise.resolve(r));return T(n,s)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const s=e(t),a=()=>r.addIssue({code:o.custom,...n(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(a(),!1)):!!s||(a(),!1)})}refinement(e,t){return this._refinement((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1))}_refinement(e){return new Se({schema:this,typeName:Pe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ne.create(this,this._def)}nullable(){return ke.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return oe.create(this)}promise(){return we.create(this,this._def)}or(e){return ce.create([this,e],this._def)}and(e){return he.create(this,e,this._def)}transform(e){return new Se({...w(this._def),schema:this,typeName:Pe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Ae({...w(this._def),innerType:this,defaultValue:t,typeName:Pe.ZodDefault})}brand(){return new Oe({typeName:Pe.ZodBranded,type:this,...w(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Ie({...w(this._def),innerType:this,catchValue:t,typeName:Pe.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return xe.create(this,e)}readonly(){return Re.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const N=/^c[^\s-]{8,}$/i,k=/^[0-9a-z]+$/,A=/^[0-9A-HJKMNP-TV-Z]{26}$/i,I=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,C=/^[a-z0-9_-]{21}$/i,O=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,x=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,R=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let P;const L=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,M=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,D=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,j=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,U=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,G=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,F="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Z=new RegExp(`^${F}$`);function V(e){let t="[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function H(e){return new RegExp(`^${V(e)}$`)}function $(e){let t=`${F}T${V(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function K(e,t){return!("v4"!==t&&t||!L.test(e))||!("v6"!==t&&t||!D.test(e))}function X(e,t){if(!O.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!("object"!=typeof s||null===s||"typ"in s&&"JWT"!==s?.typ||!s.alg||t&&s.alg!==t)}catch{return!1}}function B(e,t){return!("v4"!==t&&t||!M.test(e))||!("v6"!==t&&t||!j.test(e))}class z extends S{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==a.string){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.string,received:t.parsedType}),h}const t=new p;let r;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),f(r,{code:o.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),f(r,{code:o.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const n=e.data.length>s.value,a=e.data.length<s.value;(n||a)&&(r=this._getOrReturnCtx(e,r),n?f(r,{code:o.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&f(r,{code:o.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)R.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"email",code:o.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)P||(P=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),P.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"emoji",code:o.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)I.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"uuid",code:o.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)C.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"nanoid",code:o.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)N.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"cuid",code:o.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)k.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"cuid2",code:o.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)A.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"ulid",code:o.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),f(r,{validation:"url",code:o.invalid_string,message:s.message}),t.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"regex",code:o.invalid_string,message:s.message}),t.dirty())):"trim"===s.kind?e.data=e.data.trim():"includes"===s.kind?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),f(r,{code:o.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty()):"toLowerCase"===s.kind?e.data=e.data.toLowerCase():"toUpperCase"===s.kind?e.data=e.data.toUpperCase():"startsWith"===s.kind?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),f(r,{code:o.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),f(r,{code:o.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty()):"datetime"===s.kind?$(s).test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{code:o.invalid_string,validation:"datetime",message:s.message}),t.dirty()):"date"===s.kind?Z.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{code:o.invalid_string,validation:"date",message:s.message}),t.dirty()):"time"===s.kind?H(s).test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{code:o.invalid_string,validation:"time",message:s.message}),t.dirty()):"duration"===s.kind?x.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"duration",code:o.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?K(e.data,s.version)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"ip",code:o.invalid_string,message:s.message}),t.dirty()):"jwt"===s.kind?X(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"jwt",code:o.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?B(e.data,s.version)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"cidr",code:o.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?U.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"base64",code:o.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?G.test(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{validation:"base64url",code:o.invalid_string,message:s.message}),t.dirty()):n.assertNever(s);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:o.invalid_string,...d.errToObj(n)})}_addCheck(e){return new z({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...d.errToObj(e)})}url(e){return this._addCheck({kind:"url",...d.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...d.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...d.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...d.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...d.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...d.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...d.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...d.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...d.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...d.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...d.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...d.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...d.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...d.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...d.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...d.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...d.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...d.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...d.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...d.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...d.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...d.errToObj(t)})}nonempty(e){return this.min(1,d.errToObj(e))}trim(){return new z({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new z({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new z({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function J(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}z.create=e=>new z({checks:[],typeName:Pe.ZodString,coerce:e?.coerce??!1,...w(e)});class W extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==a.number){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.number,received:t.parsedType}),h}let t;const r=new p;for(const s of this._def.checks)"int"===s.kind?n.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),f(t,{code:o.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:o.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:o.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"multipleOf"===s.kind?0!==J(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:o.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),f(t,{code:o.not_finite,message:s.message}),r.dirty()):n.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,d.toString(t))}gt(e,t){return this.setLimit("min",e,!1,d.toString(t))}lte(e,t){return this.setLimit("max",e,!0,d.toString(t))}lt(e,t){return this.setLimit("max",e,!1,d.toString(t))}setLimit(e,t,n,r){return new W({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:d.toString(r)}]})}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:d.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:d.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:d.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:d.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:d.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:d.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:d.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:d.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:d.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&n.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}W.create=e=>new W({checks:[],typeName:Pe.ZodNumber,coerce:e?.coerce||!1,...w(e)});class q extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==a.bigint)return this._getInvalidInput(e);let t;const r=new p;for(const s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:o.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:o.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),f(t,{code:o.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):n.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.bigint,received:t.parsedType}),h}gte(e,t){return this.setLimit("min",e,!0,d.toString(t))}gt(e,t){return this.setLimit("min",e,!1,d.toString(t))}lte(e,t){return this.setLimit("max",e,!0,d.toString(t))}lt(e,t){return this.setLimit("max",e,!1,d.toString(t))}setLimit(e,t,n,r){return new q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:d.toString(r)}]})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:d.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:d.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:d.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:d.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:d.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}q.create=e=>new q({checks:[],typeName:Pe.ZodBigInt,coerce:e?.coerce??!1,...w(e)});class Y extends S{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==a.boolean){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.boolean,received:t.parsedType}),h}return m(e.data)}}Y.create=e=>new Y({typeName:Pe.ZodBoolean,coerce:e?.coerce||!1,...w(e)});class Q extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==a.date){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.date,received:t.parsedType}),h}if(Number.isNaN(e.data.getTime()))return f(this._getOrReturnCtx(e),{code:o.invalid_date}),h;const t=new p;let r;for(const s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),f(r,{code:o.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),t.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),f(r,{code:o.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),t.dirty()):n.assertNever(s);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Q({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:d.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:d.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Q.create=e=>new Q({checks:[],coerce:e?.coerce||!1,typeName:Pe.ZodDate,...w(e)});class ee extends S{_parse(e){if(this._getType(e)!==a.symbol){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.symbol,received:t.parsedType}),h}return m(e.data)}}ee.create=e=>new ee({typeName:Pe.ZodSymbol,...w(e)});class te extends S{_parse(e){if(this._getType(e)!==a.undefined){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.undefined,received:t.parsedType}),h}return m(e.data)}}te.create=e=>new te({typeName:Pe.ZodUndefined,...w(e)});class ne extends S{_parse(e){if(this._getType(e)!==a.null){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.null,received:t.parsedType}),h}return m(e.data)}}ne.create=e=>new ne({typeName:Pe.ZodNull,...w(e)});class re extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return m(e.data)}}re.create=e=>new re({typeName:Pe.ZodAny,...w(e)});class se extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return m(e.data)}}se.create=e=>new se({typeName:Pe.ZodUnknown,...w(e)});class ae extends S{_parse(e){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.never,received:t.parsedType}),h}}ae.create=e=>new ae({typeName:Pe.ZodNever,...w(e)});class ie extends S{_parse(e){if(this._getType(e)!==a.undefined){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.void,received:t.parsedType}),h}return m(e.data)}}ie.create=e=>new ie({typeName:Pe.ZodVoid,...w(e)});class oe extends S{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==a.array)return f(t,{code:o.invalid_type,expected:a.array,received:t.parsedType}),h;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(e||s)&&(f(t,{code:e?o.too_big:o.too_small,minimum:s?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(f(t,{code:o.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(f(t,{code:o.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new E(t,e,t.path,n)))).then(e=>p.mergeArray(n,e));const s=[...t.data].map((e,n)=>r.type._parseSync(new E(t,e,t.path,n)));return p.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new oe({...this._def,minLength:{value:e,message:d.toString(t)}})}max(e,t){return new oe({...this._def,maxLength:{value:e,message:d.toString(t)}})}length(e,t){return new oe({...this._def,exactLength:{value:e,message:d.toString(t)}})}nonempty(e){return this.min(1,e)}}function ue(e){if(e instanceof le){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Ne.create(ue(r))}return new le({...e._def,shape:()=>t})}return e instanceof oe?new oe({...e._def,type:ue(e.element)}):e instanceof Ne?Ne.create(ue(e.unwrap())):e instanceof ke?ke.create(ue(e.unwrap())):e instanceof ve?ve.create(e.items.map(e=>ue(e))):e}oe.create=(e,t)=>new oe({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Pe.ZodArray,...w(t)});class le extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=n.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==a.object){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.object,received:t.parsedType}),h}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:s}=this._getCached(),i=[];if(!(this._def.catchall instanceof ae&&"strip"===this._def.unknownKeys))for(const e in n.data)s.includes(e)||i.push(e);const u=[];for(const e of s){const t=r[e],s=n.data[e];u.push({key:{status:"valid",value:e},value:t._parse(new E(n,s,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof ae){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)u.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)i.length>0&&(f(n,{code:o.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const r=n.data[t];u.push({key:{status:"valid",value:t},value:e._parse(new E(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of u){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>p.mergeObjectSync(t,e)):p.mergeObjectSync(t,u)}get shape(){return this._def.shape()}strict(e){return d.errToObj,new le({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const r=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:d.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new le({...this._def,unknownKeys:"strip"})}passthrough(){return new le({...this._def,unknownKeys:"passthrough"})}extend(e){return new le({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new le({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Pe.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new le({...this._def,catchall:e})}pick(e){const t={};for(const r of n.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new le({...this._def,shape:()=>t})}omit(e){const t={};for(const r of n.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new le({...this._def,shape:()=>t})}deepPartial(){return ue(this)}partial(e){const t={};for(const r of n.objectKeys(this.shape)){const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}return new le({...this._def,shape:()=>t})}required(e){const t={};for(const r of n.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Ne;)e=e._def.innerType;t[r]=e}return new le({...this._def,shape:()=>t})}keyof(){return ye(n.objectKeys(this.shape))}}le.create=(e,t)=>new le({shape:()=>e,unknownKeys:"strip",catchall:ae.create(),typeName:Pe.ZodObject,...w(t)}),le.strictCreate=(e,t)=>new le({shape:()=>e,unknownKeys:"strict",catchall:ae.create(),typeName:Pe.ZodObject,...w(t)}),le.lazycreate=(e,t)=>new le({shape:e,unknownKeys:"strip",catchall:ae.create(),typeName:Pe.ZodObject,...w(t)});class ce extends S{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map(e=>new u(e.ctx.common.issues));return f(t,{code:o.invalid_union,unionErrors:n}),h});{let e;const r=[];for(const s of n){const n={...t,common:{...t.common,issues:[]},parent:null},a=s._parseSync({data:t.data,path:t.path,parent:n});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=r.map(e=>new u(e));return f(t,{code:o.invalid_union,unionErrors:s}),h}}get options(){return this._def.options}}ce.create=(e,t)=>new ce({options:e,typeName:Pe.ZodUnion,...w(t)});const de=e=>e instanceof _e?de(e.schema):e instanceof Se?de(e.innerType()):e instanceof be?[e.value]:e instanceof Ee?e.options:e instanceof Te?n.objectValues(e.enum):e instanceof Ae?de(e._def.innerType):e instanceof te?[void 0]:e instanceof ne?[null]:e instanceof Ne?[void 0,...de(e.unwrap())]:e instanceof ke?[null,...de(e.unwrap())]:e instanceof Oe||e instanceof Re?de(e.unwrap()):e instanceof Ie?de(e._def.innerType):[];class fe extends S{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==a.object)return f(t,{code:o.invalid_type,expected:a.object,received:t.parsedType}),h;const n=this.discriminator,r=t.data[n],s=this.optionsMap.get(r);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(f(t,{code:o.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),h)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=de(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(r.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,n)}}return new fe({typeName:Pe.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...w(n)})}}function pe(e,t){const r=i(e),s=i(t);if(e===t)return{valid:!0,data:e};if(r===a.object&&s===a.object){const r=n.objectKeys(t),s=n.objectKeys(e).filter(e=>-1!==r.indexOf(e)),a={...e,...t};for(const n of s){const r=pe(e[n],t[n]);if(!r.valid)return{valid:!1};a[n]=r.data}return{valid:!0,data:a}}if(r===a.array&&s===a.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const s=pe(e[r],t[r]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return r===a.date&&s===a.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class he extends S{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(g(e)||g(r))return h;const s=pe(e.value,r.value);return s.valid?((_(e)||_(r))&&t.dirty(),{status:t.value,value:s.data}):(f(n,{code:o.invalid_intersection_types}),h)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}he.create=(e,t,n)=>new he({left:e,right:t,typeName:Pe.ZodIntersection,...w(n)});class ve extends S{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==a.array)return f(n,{code:o.invalid_type,expected:a.array,received:n.parsedType}),h;if(n.data.length<this._def.items.length)return f(n,{code:o.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),h;!this._def.rest&&n.data.length>this._def.items.length&&(f(n,{code:o.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new E(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>p.mergeArray(t,e)):p.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new ve({...this._def,rest:e})}}ve.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ve({items:e,typeName:Pe.ZodTuple,rest:null,...w(t)})};class me extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==a.map)return f(n,{code:o.invalid_type,expected:a.map,received:n.parsedType}),h;const r=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([e,t],a)=>({key:r._parse(new E(n,e,n.path,[a,"key"])),value:s._parse(new E(n,t,n.path,[a,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of i){const r=await n.key,s=await n.value;if("aborted"===r.status||"aborted"===s.status)return h;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of i){const r=n.key,s=n.value;if("aborted"===r.status||"aborted"===s.status)return h;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}}}me.create=(e,t,n)=>new me({valueType:t,keyType:e,typeName:Pe.ZodMap,...w(n)});class ge extends S{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==a.set)return f(n,{code:o.invalid_type,expected:a.set,received:n.parsedType}),h;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(f(n,{code:o.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(f(n,{code:o.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function i(e){const n=new Set;for(const r of e){if("aborted"===r.status)return h;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const u=[...n.data.values()].map((e,t)=>s._parse(new E(n,e,n.path,t)));return n.common.async?Promise.all(u).then(e=>i(e)):i(u)}min(e,t){return new ge({...this._def,minSize:{value:e,message:d.toString(t)}})}max(e,t){return new ge({...this._def,maxSize:{value:e,message:d.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ge.create=(e,t)=>new ge({valueType:e,minSize:null,maxSize:null,typeName:Pe.ZodSet,...w(t)});class _e extends S{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}_e.create=(e,t)=>new _e({getter:e,typeName:Pe.ZodLazy,...w(t)});class be extends S{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return f(t,{received:t.data,code:o.invalid_literal,expected:this._def.value}),h}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ye(e,t){return new Ee({values:e,typeName:Pe.ZodEnum,...w(t)})}be.create=(e,t)=>new be({value:e,typeName:Pe.ZodLiteral,...w(t)});class Ee extends S{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return f(t,{expected:n.joinValues(r),received:t.parsedType,code:o.invalid_type}),h}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return f(t,{received:t.data,code:o.invalid_enum_value,options:n}),h}return m(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ee.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ee.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Ee.create=ye;class Te extends S{_parse(e){const t=n.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==a.string&&r.parsedType!==a.number){const e=n.objectValues(t);return f(r,{expected:n.joinValues(e),received:r.parsedType,code:o.invalid_type}),h}if(this._cache||(this._cache=new Set(n.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=n.objectValues(t);return f(r,{received:r.data,code:o.invalid_enum_value,options:e}),h}return m(e.data)}get enum(){return this._def.values}}Te.create=(e,t)=>new Te({values:e,typeName:Pe.ZodNativeEnum,...w(t)});class we extends S{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==a.promise&&!1===t.common.async)return f(t,{code:o.invalid_type,expected:a.promise,received:t.parsedType}),h;const n=t.parsedType===a.promise?t.data:Promise.resolve(t.data);return m(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}we.create=(e,t)=>new we({type:e,typeName:Pe.ZodPromise,...w(t)});class Se extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Pe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:e=>{f(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===s.type){const e=s.transform(r.data,a);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return h;const n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?h:"dirty"===n.status||"dirty"===t.value?v(n.value):n});{if("aborted"===t.value)return h;const n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?h:"dirty"===n.status||"dirty"===t.value?v(n.value):n}}if("refinement"===s.type){const e=e=>{const t=s.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?h:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(n=>"aborted"===n.status?h:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===s.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!b(e))return h;const n=s.transform(e.value,a);if(n instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>b(e)?Promise.resolve(s.transform(e.value,a)).then(e=>({status:t.value,value:e})):h)}n.assertNever(s)}}Se.create=(e,t,n)=>new Se({schema:e,typeName:Pe.ZodEffects,effect:t,...w(n)}),Se.createWithPreprocess=(e,t,n)=>new Se({schema:t,effect:{type:"preprocess",transform:e},typeName:Pe.ZodEffects,...w(n)});class Ne extends S{_parse(e){return this._getType(e)===a.undefined?m(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ne.create=(e,t)=>new Ne({innerType:e,typeName:Pe.ZodOptional,...w(t)});class ke extends S{_parse(e){return this._getType(e)===a.null?m(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ke.create=(e,t)=>new ke({innerType:e,typeName:Pe.ZodNullable,...w(t)});class Ae extends S{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===a.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ae.create=(e,t)=>new Ae({innerType:e,typeName:Pe.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...w(t)});class Ie extends S{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return y(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new u(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new u(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Ie.create=(e,t)=>new Ie({innerType:e,typeName:Pe.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...w(t)});class Ce extends S{_parse(e){if(this._getType(e)!==a.nan){const t=this._getOrReturnCtx(e);return f(t,{code:o.invalid_type,expected:a.nan,received:t.parsedType}),h}return{status:"valid",value:e.data}}}Ce.create=e=>new Ce({typeName:Pe.ZodNaN,...w(e)}),Symbol("zod_brand");class Oe extends S{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class xe extends S{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?h:"dirty"===e.status?(t.dirty(),v(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?h:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new xe({in:e,out:t,typeName:Pe.ZodPipeline})}}class Re extends S{_parse(e){const t=this._def.innerType._parse(e),n=e=>(b(e)&&(e.value=Object.freeze(e.value)),e);return y(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}var Pe;Re.create=(e,t)=>new Re({innerType:e,typeName:Pe.ZodReadonly,...w(t)}),le.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Pe||(Pe={}));const Le=z.create,Me=W.create,De=(Ce.create,q.create,Y.create),je=(Q.create,ee.create,te.create,ne.create,re.create),Ue=(se.create,ae.create,ie.create,oe.create),Ge=le.create,Fe=(le.strictCreate,ce.create),Ze=fe.create,Ve=(he.create,ve.create,me.create,ge.create,_e.create,be.create),He=Ee.create,$e=Te.create;we.create,Se.create,Ne.create,ke.create,Se.createWithPreprocess,xe.create;var Ke=Ge({name:Le(),arguments:Le()}),Xe=Ge({id:Le(),type:Ve("function"),function:Ke}),Be=Ge({id:Le(),role:Le(),content:Le().optional(),name:Le().optional()}),ze=Ze("role",[Be.extend({role:Ve("developer"),content:Le()}),Be.extend({role:Ve("system"),content:Le()}),Be.extend({role:Ve("assistant"),content:Le().optional(),toolCalls:Ue(Xe).optional()}),Be.extend({role:Ve("user"),content:Le()}),Ge({id:Le(),content:Le(),role:Ve("tool"),toolCallId:Le()})]),Je=(Fe([Ve("developer"),Ve("system"),Ve("assistant"),Ve("user"),Ve("tool")]),Ge({description:Le(),value:Le()})),We=Ge({name:Le(),description:Le(),parameters:je()}),qe=(Ge({threadId:Le(),runId:Le(),state:je(),messages:Ue(ze),tools:Ue(We),context:Ue(Je),forwardedProps:je()}),je()),Ye=class extends Error{constructor(e){super(e)}},Qe=(e=>(e.TEXT_MESSAGE_START="TEXT_MESSAGE_START",e.TEXT_MESSAGE_CONTENT="TEXT_MESSAGE_CONTENT",e.TEXT_MESSAGE_END="TEXT_MESSAGE_END",e.TEXT_MESSAGE_CHUNK="TEXT_MESSAGE_CHUNK",e.THINKING_TEXT_MESSAGE_START="THINKING_TEXT_MESSAGE_START",e.THINKING_TEXT_MESSAGE_CONTENT="THINKING_TEXT_MESSAGE_CONTENT",e.THINKING_TEXT_MESSAGE_END="THINKING_TEXT_MESSAGE_END",e.TOOL_CALL_START="TOOL_CALL_START",e.TOOL_CALL_ARGS="TOOL_CALL_ARGS",e.TOOL_CALL_END="TOOL_CALL_END",e.TOOL_CALL_CHUNK="TOOL_CALL_CHUNK",e.TOOL_CALL_RESULT="TOOL_CALL_RESULT",e.THINKING_START="THINKING_START",e.THINKING_END="THINKING_END",e.STATE_SNAPSHOT="STATE_SNAPSHOT",e.STATE_DELTA="STATE_DELTA",e.MESSAGES_SNAPSHOT="MESSAGES_SNAPSHOT",e.RAW="RAW",e.CUSTOM="CUSTOM",e.RUN_STARTED="RUN_STARTED",e.RUN_FINISHED="RUN_FINISHED",e.RUN_ERROR="RUN_ERROR",e.STEP_STARTED="STEP_STARTED",e.STEP_FINISHED="STEP_FINISHED",e))(Qe||{}),et=Ge({type:$e(Qe),timestamp:Me().optional(),rawEvent:je().optional()}),tt=et.extend({type:Ve("TEXT_MESSAGE_START"),messageId:Le(),role:Ve("assistant")}),nt=et.extend({type:Ve("TEXT_MESSAGE_CONTENT"),messageId:Le(),delta:Le().refine(e=>e.length>0,"Delta must not be an empty string")}),rt=et.extend({type:Ve("TEXT_MESSAGE_END"),messageId:Le()}),st=et.extend({type:Ve("TEXT_MESSAGE_CHUNK"),messageId:Le().optional(),role:Ve("assistant").optional(),delta:Le().optional()}),at=et.extend({type:Ve("THINKING_TEXT_MESSAGE_START")}),it=nt.omit({messageId:!0,type:!0}).extend({type:Ve("THINKING_TEXT_MESSAGE_CONTENT")}),ot=et.extend({type:Ve("THINKING_TEXT_MESSAGE_END")}),ut=et.extend({type:Ve("TOOL_CALL_START"),toolCallId:Le(),toolCallName:Le(),parentMessageId:Le().optional()}),lt=et.extend({type:Ve("TOOL_CALL_ARGS"),toolCallId:Le(),delta:Le()}),ct=et.extend({type:Ve("TOOL_CALL_END"),toolCallId:Le()}),dt=et.extend({messageId:Le(),type:Ve("TOOL_CALL_RESULT"),toolCallId:Le(),content:Le(),role:Ve("tool").optional()}),ft=et.extend({type:Ve("TOOL_CALL_CHUNK"),toolCallId:Le().optional(),toolCallName:Le().optional(),parentMessageId:Le().optional(),delta:Le().optional()}),pt=(et.extend({type:Ve("THINKING_START"),title:Le().optional()}),et.extend({type:Ve("THINKING_END")}),Ze("type",[tt,nt,rt,st,at,it,ot,ut,lt,ct,ft,dt,et.extend({type:Ve("STATE_SNAPSHOT"),snapshot:qe}),et.extend({type:Ve("STATE_DELTA"),delta:Ue(je())}),et.extend({type:Ve("MESSAGES_SNAPSHOT"),messages:Ue(ze)}),et.extend({type:Ve("RAW"),event:je(),source:Le().optional()}),et.extend({type:Ve("CUSTOM"),name:Le(),value:je()}),et.extend({type:Ve("RUN_STARTED"),threadId:Le(),runId:Le()}),et.extend({type:Ve("RUN_FINISHED"),threadId:Le(),runId:Le(),result:je().optional()}),et.extend({type:Ve("RUN_ERROR"),message:Le(),code:Le().optional()}),et.extend({type:Ve("STEP_STARTED"),stepName:Le()}),et.extend({type:Ve("STEP_FINISHED"),stepName:Le()})]));function ht(e){return"function"==typeof e}function vt(e){return function(t){if(function(e){return ht(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}var mt=function(e,t){return mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},mt(e,t)};function gt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}mt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function _t(e,t){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function bt(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function yt(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(s)throw s.error}}return i}function Et(e,t,n){if(n||2===arguments.length)for(var r,s=0,a=t.length;s<a;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}function Tt(e){return this instanceof Tt?(this.v=e,this):new Tt(e)}function wt(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var St=wt(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function Nt(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var kt=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var i=bt(a),o=i.next();!o.done;o=i.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(ht(u))try{u()}catch(e){s=e instanceof St?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var c=bt(l),d=c.next();!d.done;d=c.next()){var f=d.value;try{Ct(f)}catch(e){s=null!=s?s:[],e instanceof St?s=Et(Et([],yt(s)),yt(e.errors)):s.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}if(s)throw new St(s)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Ct(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Nt(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Nt(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),At=kt.EMPTY;function It(e){return e instanceof kt||e&&"closed"in e&&ht(e.remove)&&ht(e.add)&&ht(e.unsubscribe)}function Ct(e){ht(e)?e():e.unsubscribe()}var Ot=null,xt=null,Rt=void 0,Pt=!1,Lt=!1,Mt={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var s=Mt.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,Et([e,t],yt(n))):setTimeout.apply(void 0,Et([e,t],yt(n)))},clearTimeout:function(e){var t=Mt.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Dt(e){Mt.setTimeout(function(){if(!Ot)throw e;Ot(e)})}function jt(){}var Ut=Gt("C",void 0,void 0);function Gt(e,t,n){return{kind:e,value:t,error:n}}var Ft=null;function Zt(e){if(Pt){var t=!Ft;if(t&&(Ft={errorThrown:!1,error:null}),e(),t){var n=Ft,r=n.errorThrown,s=n.error;if(Ft=null,r)throw s}}else e()}var Vt=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,It(t)&&t.add(n)):n.destination=Jt,n}return gt(t,e),t.create=function(e,t,n){return new Xt(e,t,n)},t.prototype.next=function(e){this.isStopped?zt(function(e){return Gt("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?zt(Gt("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?zt(Ut,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(kt),Ht=Function.prototype.bind;function $t(e,t){return Ht.call(e,t)}var Kt=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Bt(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Bt(e)}else Bt(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Bt(e)}},e}(),Xt=function(e){function t(t,n,r){var s,a,i=e.call(this)||this;return ht(t)||!t?s={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:i&&Lt?((a=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},s={next:t.next&&$t(t.next,a),error:t.error&&$t(t.error,a),complete:t.complete&&$t(t.complete,a)}):s=t,i.destination=new Kt(s),i}return gt(t,e),t}(Vt);function Bt(e){var t;Pt?(t=e,Pt&&Ft&&(Ft.errorThrown=!0,Ft.error=t)):Dt(e)}function zt(e,t){var n=xt;n&&Mt.setTimeout(function(){return n(e,t)})}var Jt={closed:!0,next:jt,error:function(e){throw e},complete:jt};function Wt(e,t,n,r,s){return new qt(e,t,n,r,s)}var qt=function(e){function t(t,n,r,s,a,i){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=i,o._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=s?function(e){try{s(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return gt(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Vt);function Yt(e,t){return vt(function(n,r){var s=0;n.subscribe(Wt(r,function(n){r.next(e.call(t,n,s++))}))})}var Qt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function en(e){return ht(null==e?void 0:e.then)}var tn="function"==typeof Symbol&&Symbol.observable||"@@observable";function nn(e){return e}function rn(e){return 0===e.length?nn:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var sn=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,s=this,a=(r=e)&&r instanceof Vt||function(e){return e&&ht(e.next)&&ht(e.error)&&ht(e.complete)}(r)&&It(r)?e:new Xt(e,t,n);return Zt(function(){var e=s,t=e.operator,n=e.source;a.add(t?t.call(a,n):n?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=an(t))(function(t,r){var s=new Xt({next:function(t){try{e(t)}catch(e){r(e),s.unsubscribe()}},error:r,complete:t});n.subscribe(s)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[tn]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return rn(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=an(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function an(e){var t;return null!==(t=null!=e?e:Rt)&&void 0!==t?t:Promise}function on(e){return ht(e[tn])}function un(e){return Symbol.asyncIterator&&ht(null==e?void 0:e[Symbol.asyncIterator])}function ln(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var cn="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function dn(e){return ht(null==e?void 0:e[cn])}function fn(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=n.apply(e,t||[]),a=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),r[Symbol.asyncIterator]=function(){return this},r;function i(e,t){s[e]&&(r[e]=function(t){return new Promise(function(n,r){a.push([e,t,n,r])>1||o(e,t)})},t&&(r[e]=t(r[e])))}function o(e,t){try{(n=s[e](t)).value instanceof Tt?Promise.resolve(n.value.v).then(u,l):c(a[0][2],n)}catch(e){c(a[0][3],e)}var n}function u(e){o("next",e)}function l(e){o("throw",e)}function c(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,function(){var t,n,r;return _t(this,function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Tt(t.read())];case 3:return n=s.sent(),r=n.value,n.done?[4,Tt(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Tt(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function pn(e){return ht(null==e?void 0:e.getReader)}function hn(e){if(e instanceof sn)return e;if(null!=e){if(on(e))return s=e,new sn(function(e){var t=s[tn]();if(ht(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(Qt(e))return r=e,new sn(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()});if(en(e))return n=e,new sn(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Dt)});if(un(e))return vn(e);if(dn(e))return t=e,new sn(function(e){var n,r;try{for(var s=bt(t),a=s.next();!a.done;a=s.next()){var i=a.value;if(e.next(i),e.closed)return}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}e.complete()});if(pn(e))return vn(fn(e))}var t,n,r,s;throw ln(e)}function vn(e){return new sn(function(t){(function(e,t){var n,r,s,a,i,o,u,l;return i=this,o=void 0,l=function(){var i,o;return _t(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=bt(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,s){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,s,(t=e[n](t)).done,t.value)})}}}(e),u.label=1;case 1:return[4,n.next()];case 2:if((r=u.sent()).done)return[3,4];if(i=r.value,t.next(i),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=u.sent(),s={error:o},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new((u=void 0)||(u=Promise))(function(e,t){function n(e){try{s(l.next(e))}catch(e){t(e)}}function r(e){try{s(l.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof u?s:new u(function(e){e(s)})).then(n,r)}s((l=l.apply(i,o||[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function mn(e,t,n,r,s){void 0===r&&(r=0),void 0===s&&(s=!1);var a=t.schedule(function(){n(),s?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(a),!s)return a}function gn(e,t,n){return void 0===n&&(n=1/0),ht(t)?gn(function(n,r){return Yt(function(e,s){return t(n,e,r,s)})(hn(e(n,r)))},n):("number"==typeof t&&(n=t),vt(function(t,r){return function(e,t,n,r){var s=[],a=0,i=0,o=!1,u=function(){!o||s.length||a||t.complete()},l=function(e){return a<r?c(e):s.push(e)},c=function(e){a++;var o=!1;hn(n(e,i++)).subscribe(Wt(t,function(e){t.next(e)},function(){o=!0},void 0,function(){if(o)try{a--;for(var e=function(){var e=s.shift();c(e)};s.length&&a<r;)e();u()}catch(e){t.error(e)}}))};return e.subscribe(Wt(t,l,function(){o=!0,u()})),function(){}}(t,r,e,n)}))}function _n(e,t){return void 0===t&&(t=0),vt(function(n,r){n.subscribe(Wt(r,function(n){return mn(r,e,function(){return r.next(n)},t)},function(){return mn(r,e,function(){return r.complete()},t)},function(n){return mn(r,e,function(){return r.error(n)},t)}))})}function bn(e,t){return void 0===t&&(t=0),vt(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function yn(e,t){if(!e)throw new Error("Iterable cannot be null");return new sn(function(n){mn(n,t,function(){var r=e[Symbol.asyncIterator]();mn(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function En(e,t){return t?function(e,t){if(null!=e){if(on(e))return function(e,t){return hn(e).pipe(bn(t),_n(t))}(e,t);if(Qt(e))return function(e,t){return new sn(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(en(e))return function(e,t){return hn(e).pipe(bn(t),_n(t))}(e,t);if(un(e))return yn(e,t);if(dn(e))return function(e,t){return new sn(function(n){var r;return mn(n,t,function(){r=e[cn](),mn(n,t,function(){var e,t,s;try{t=(e=r.next()).value,s=e.done}catch(e){return void n.error(e)}s?n.complete():n.next(t)},0,!0)}),function(){return ht(null==r?void 0:r.return)&&r.return()}})}(e,t);if(pn(e))return function(e,t){return yn(fn(e),t)}(e,t)}throw ln(e)}(e,t):hn(e)}function Tn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return En(e,function(e){return(n=(t=e)[t.length-1])&&ht(n.schedule)?e.pop():void 0;var t,n}(e))}var wn=new sn(function(e){return e.complete()}),Sn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nn=Object.prototype.hasOwnProperty;function kn(e,t){return Nn.call(e,t)}function An(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var s in e)kn(e,s)&&r.push(s);return r}function In(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Cn(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function On(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function xn(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Rn(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Rn(e[t]))return!0}else if("object"==typeof e)for(var r=An(e),s=r.length,a=0;a<s;a++)if(Rn(e[r[a]]))return!0;return!1}function Pn(e,t){var n=[e];for(var r in t){var s="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==s&&n.push(r+": "+s)}return n.join("\n")}var Ln=function(e){function t(t,n,r,s,a){var i=this.constructor,o=e.call(this,Pn(t,{name:n,index:r,operation:s,tree:a}))||this;return o.name=n,o.index=r,o.operation=s,o.tree=a,Object.setPrototypeOf(o,i.prototype),o.message=Pn(t,{name:n,index:r,operation:s,tree:a}),o}return Sn(t,e),t}(Error),Mn=Ln,Dn=In,jn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Gn(n,this.path);r&&(r=In(r));var s=Fn(n,{op:"remove",path:this.from}).removed;return Fn(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Gn(n,this.from);return Fn(n,{op:"add",path:this.path,value:In(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Kn(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Un={add:function(e,t,n){return Cn(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:jn.move,copy:jn.copy,test:jn.test,_get:jn._get};function Gn(e,t){if(""==t)return e;var n={op:"_get",path:t};return Fn(e,n),n.value}function Fn(e,t,n,r,s,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===s&&(s=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):Hn(t,0)),""===t.path){var i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=Gn(e,t.from),"move"===t.op&&(i.removed=e),i;if("test"===t.op){if(i.test=Kn(e,t.value),!1===i.test)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i.newDocument=e,i}if("remove"===t.op)return i.removed=e,i.newDocument=null,i;if("_get"===t.op)return t.value=e,i;if(n)throw new Mn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return i}r||(e=In(e));var o=(t.path||"").split("/"),u=e,l=1,c=o.length,d=void 0,f=void 0,p=void 0;for(p="function"==typeof n?n:Hn;;){if((f=o[l])&&-1!=f.indexOf("~")&&(f=xn(f)),s&&("__proto__"==f||"prototype"==f&&l>0&&"constructor"==o[l-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===u[f]?d=o.slice(0,l).join("/"):l==c-1&&(d=t.path),void 0!==d&&p(t,0,e,d)),l++,Array.isArray(u)){if("-"===f)f=u.length;else{if(n&&!Cn(f))throw new Mn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Cn(f)&&(f=~~f)}if(l>=c){if(n&&"add"===t.op&&f>u.length)throw new Mn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(i=Un[t.op].call(t,u,f,e)).test)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}}else if(l>=c){if(!1===(i=jn[t.op].call(t,u,f,e)).test)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}if(u=u[f],n&&l<c&&(!u||"object"!=typeof u))throw new Mn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}function Zn(e,t,n,r,s){if(void 0===r&&(r=!0),void 0===s&&(s=!0),n&&!Array.isArray(t))throw new Mn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=In(e));for(var a=new Array(t.length),i=0,o=t.length;i<o;i++)a[i]=Fn(e,t[i],n,!0,s,i),e=a[i].newDocument;return a.newDocument=e,a}function Vn(e,t,n){var r=Fn(e,t);if(!1===r.test)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Hn(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new Mn("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!jn[e.op])throw new Mn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new Mn("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new Mn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new Mn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new Mn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&Rn(e.value))throw new Mn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var s=e.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new Mn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new Mn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var i=$n([{op:"_get",path:e.from,value:void 0}],n);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new Mn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function $n(e,t,n){try{if(!Array.isArray(e))throw new Mn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Zn(In(t),In(e),n||!0);else{n=n||Hn;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof Mn)return e;throw e}}function Kn(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,s,a=Array.isArray(e),i=Array.isArray(t);if(a&&i){if((r=e.length)!=t.length)return!1;for(n=r;0!==n--;)if(!Kn(e[n],t[n]))return!1;return!0}if(a!=i)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!==n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!==n--;)if(!Kn(e[s=o[n]],t[s]))return!1;return!0}return e!=e&&t!=t}var Xn=new WeakMap,Bn=function(e){this.observers=new Map,this.obj=e},zn=function(e,t){this.callback=e,this.observer=t};function Jn(e,t){t.unobserve()}function Wn(e,t){var n,r=function(e){return Xn.get(e)}(e);if(r){var s=function(e,t){return e.observers.get(t)}(r,t);n=s&&s.observer}else r=new Bn(e),Xn.set(e,r);if(n)return n;if(n={},r.value=In(e),t){n.callback=t,n.next=null;var a=function(){qn(n)},i=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return n.patches=[],n.object=e,n.unobserve=function(){qn(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},r.observers.set(t,new zn(t,n)),n}function qn(e,t){void 0===t&&(t=!1);var n=Xn.get(e.object);Yn(n.value,e.object,e.patches,"",t),e.patches.length&&Zn(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Yn(e,t,n,r,s){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=An(t),i=An(e),o=!1,u=i.length-1;u>=0;u--){var l=e[d=i[u]];if(!kn(t,d)||void 0===t[d]&&void 0!==l&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+On(d),value:In(l)}),n.push({op:"remove",path:r+"/"+On(d)}),o=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[d];"object"==typeof l&&null!=l&&"object"==typeof c&&null!=c&&Array.isArray(l)===Array.isArray(c)?Yn(l,c,n,r+"/"+On(d),s):l!==c&&(s&&n.push({op:"test",path:r+"/"+On(d),value:In(l)}),n.push({op:"replace",path:r+"/"+On(d),value:In(c)}))}}if(o||a.length!=i.length)for(u=0;u<a.length;u++){var d;kn(e,d=a[u])||void 0===t[d]||n.push({op:"add",path:r+"/"+On(d),value:In(t[d])})}}}function Qn(e,t,n){void 0===n&&(n=!1);var r=[];return Yn(e,t,r,"",n),r}function er(e){return" \r\n\t".indexOf(e)>=0}function tr(e){for(var t,n,r,s=["topLevel"],a=0,i=function(e){return s.push(e)},o=function(e){return s[s.length-1]=e},u=function(e){null==t&&(t=a,n=s.length,r=e)},l=function(e){e===r&&(t=void 0,n=void 0,r=void 0)},c=function(){return s.pop()},d=function(){return a--},f=function(e){if("0"<=e&&e<="9")i("number");else switch(e){case'"':return void i("string");case"-":return void i("numberNeedsDigit");case"t":return void i("true");case"f":return void i("false");case"n":return void i("null");case"[":return void i("arrayNeedsValue");case"{":return void i("objectNeedsKey")}},p=e.length;a<p;a++){var h=e[a];switch(s[s.length-1]){case"topLevel":f(h);break;case"string":switch(h){case'"':c();break;case"\\":u("stringEscape"),i("stringEscaped")}break;case"stringEscaped":"u"===h?i("stringUnicode"):(l("stringEscape"),c());break;case"stringUnicode":a-e.lastIndexOf("u",a)===4&&(l("stringEscape"),c());break;case"number":"."===h?o("numberNeedsDigit"):"e"===h||"E"===h?o("numberNeedsExponent"):(h<"0"||h>"9")&&(d(),c());break;case"numberNeedsDigit":o("number");break;case"numberNeedsExponent":o("+"===h||"-"===h?"numberNeedsDigit":"number");break;case"true":case"false":case"null":(h<"a"||h>"z")&&(d(),c());break;case"arrayNeedsValue":"]"===h?c():er(h)||(l("collectionItem"),o("arrayNeedsComma"),f(h));break;case"arrayNeedsComma":"]"===h?c():","===h&&(u("collectionItem"),o("arrayNeedsValue"));break;case"objectNeedsKey":"}"===h?c():'"'===h&&(u("collectionItem"),o("objectNeedsColon"),i("string"));break;case"objectNeedsColon":":"===h&&o("objectNeedsValue");break;case"objectNeedsValue":er(h)||(l("collectionItem"),o("objectNeedsComma"),f(h));break;case"objectNeedsComma":"}"===h?c():","===h&&(u("collectionItem"),o("objectNeedsKey"))}}null!=n&&(s.length=n);for(var v=[null!=t?e.slice(0,t):e],m=function(t){return v.push(t.slice(e.length-e.lastIndexOf(t[0])))},g=s.length-1;g>=0;g--)switch(s[g]){case"string":v.push('"');break;case"numberNeedsDigit":case"numberNeedsExponent":v.push("0");break;case"true":m("true");break;case"false":m("false");break;case"null":m("null");break;case"arrayNeedsValue":case"arrayNeedsComma":v.push("]");break;case"objectNeedsKey":case"objectNeedsColon":case"objectNeedsValue":case"objectNeedsComma":v.push("}")}return v.join("")}function nr(e,t){var n=ht(e)?e:function(){return e},r=function(e){return e.error(n())};return new sn(t?function(e){return t.schedule(r,0,e)}:r)}Object.assign({},t,s,{JsonPatchError:Ln,deepClone:In,escapePathComponent:On,unescapePathComponent:xn});var rr=wt(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),sr=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return gt(t,e),t.prototype.lift=function(e){var t=new ar(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new rr},t.prototype.next=function(e){var t=this;Zt(function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var s=bt(t.currentObservers),a=s.next();!a.done;a=s.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;Zt(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Zt(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,s=n.isStopped,a=n.observers;return r||s?At:(this.currentObservers=null,a.push(e),new kt(function(){t.currentObservers=null,Nt(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,s=t.isStopped;n?e.error(r):s&&e.complete()},t.prototype.asObservable=function(){var e=new sn;return e.source=this,e},t.create=function(e,t){return new ar(e,t)},t}(sn),ar=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return gt(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:At},t}(sr),ir={now:function(){return(ir.delegate||Date).now()},delegate:void 0},or=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=ir);var s=e.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=r,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return gt(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,s=n._buffer,a=n._infiniteTimeWindow,i=n._timestampProvider,o=n._windowTime;r||(s.push(t),!a&&s.push(i.now()+o)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),s=0;s<r.length&&!e.closed;s+=n?1:2)e.next(r[s]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,s=e._infiniteTimeWindow,a=(s?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!s){for(var i=n.now(),o=0,u=1;u<r.length&&r[u]<=i;u+=2)o=u;o&&r.splice(0,o+1)}},t}(sr);function ur(){let e=0,t=0;for(let n=0;n<28;n+=7){let r=this.buf[this.pos++];if(e|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let n=3;n<=31;n+=7){let r=this.buf[this.pos++];if(t|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function lr(e,t,n){for(let r=0;r<28;r+=7){const s=e>>>r,a=!(s>>>7==0&&0==t),i=255&(a?128|s:s);if(n.push(i),!a)return}const r=e>>>28&15|(7&t)<<4,s=!!(t>>3);if(n.push(255&(s?128|r:r)),s){for(let e=3;e<31;e+=7){const r=t>>>e,s=!(r>>>7==0),a=255&(s?128|r:r);if(n.push(a),!s)return}n.push(t>>>31&1)}}const cr=4294967296;function dr(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let r=0,s=0;function a(t,a){const i=Number(e.slice(t,a));s*=n,r=r*n+i,r>=cr&&(s+=r/cr|0,r%=cr)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?hr(r,s):pr(r,s)}function fr(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(cr*t+e);const n=16777215&(e>>>24|t<<8),r=t>>16&65535;let s=(16777215&e)+6777216*n+6710656*r,a=n+8147497*r,i=2*r;const o=1e7;return s>=o&&(a+=Math.floor(s/o),s%=o),a>=o&&(i+=Math.floor(a/o),a%=o),i.toString()+vr(a)+vr(s)}function pr(e,t){return{lo:0|e,hi:0|t}}function hr(e,t){return t=~t,e?e=1+~e:t+=1,pr(e,t)}const vr=e=>{const t=String(e);return"0000000".slice(t.length)+t};function mr(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function gr(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}const _r=br();function br(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof process.env||"1"!==process.env.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),r=BigInt("0"),s=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const r="bigint"==typeof e?e:BigInt(e);if(r>n||r<t)throw new Error(`invalid int64: ${e}`);return r},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>s||t<r)throw new Error(`invalid uint64: ${e}`);return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),yr(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),Er(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),yr(e),dr(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),Er(e),dr(e)),dec:(e,t)=>function(e,t){let n=pr(e,t);const r=2147483648&n.hi;r&&(n=hr(n.lo,n.hi));const s=fr(n.lo,n.hi);return r?"-"+s:s}(e,t),uDec:(e,t)=>fr(e,t)}}function yr(e){if(!/^-?[0-9]+$/.test(e))throw new Error("invalid int64: "+e)}function Er(e){if(!/^[0-9]+$/.test(e))throw new Error("invalid uint64: "+e)}const Tr=Symbol.for("@bufbuild/protobuf/text-encoding");function wr(){if(null==globalThis[Tr]){const e=new globalThis.TextEncoder,t=new globalThis.TextDecoder;globalThis[Tr]={encodeUtf8:t=>e.encode(t),decodeUtf8:e=>t.decode(e),checkUtf8(e){try{return encodeURIComponent(e),!0}catch(e){return!1}}}}return globalThis[Tr]}var Sr;!function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(Sr||(Sr={}));class Nr{constructor(e=wr().encodeUtf8){this.encodeUtf8=e,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),n=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],n),n+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ir(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return Ar(e),mr(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.encodeUtf8(e);return this.uint32(t.byteLength),this.raw(t)}float(e){!function(e){if("string"==typeof e){const t=e;if(e=Number(e),Number.isNaN(e)&&"NaN"!==t)throw new Error("invalid float32: "+t)}else if("number"!=typeof e)throw new Error("invalid float32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float32: "+e)}(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Ir(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Ar(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Ar(e),mr(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),r=_r.enc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),r=_r.uEnc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=_r.enc(e);return lr(t.lo,t.hi,this.buf),this}sint64(e){const t=_r.enc(e),n=t.hi>>31;return lr(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){const t=_r.uEnc(e);return lr(t.lo,t.hi,this.buf),this}}class kr{constructor(e,t=wr().decodeUtf8){this.decodeUtf8=t,this.varint64=ur,this.uint32=gr,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case Sr.Varint:for(;128&this.buf[this.pos++];);break;case Sr.Bit64:this.pos+=4;case Sr.Bit32:this.pos+=4;break;case Sr.LengthDelimited:let n=this.uint32();this.pos+=n;break;case Sr.StartGroup:for(;;){const[e,n]=this.tag();if(n===Sr.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return _r.dec(...this.varint64())}uint64(){return _r.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,_r.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return _r.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return _r.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.decodeUtf8(this.bytes())}}function Ar(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw new Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int32: "+e)}function Ir(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw new Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint32: "+e)}var Cr={encode:(e,t=new Nr)=>(Object.entries(e.fields).forEach(([e,n])=>{void 0!==n&&Or.encode({key:e,value:n},t.uint32(10).fork()).join()}),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={fields:{}};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:{if(10!==e)break;const t=Or.decode(n,n.uint32());void 0!==t.value&&(s.fields[t.key]=t.value);continue}}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Cr.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={fields:{}};return n.fields=Object.entries(null!=(t=e.fields)?t:{}).reduce((e,[t,n])=>(void 0!==n&&(e[t]=n),e),{}),n},wrap(e){const t={fields:{}};if(void 0!==e)for(const n of Object.keys(e))t.fields[n]=e[n];return t},unwrap(e){const t={};if(e.fields)for(const n of Object.keys(e.fields))t[n]=e.fields[n];return t}},Or={encode:(e,t=new Nr)=>(""!==e.key&&t.uint32(10).string(e.key),void 0!==e.value&&xr.encode(xr.wrap(e.value),t.uint32(18).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={key:"",value:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.key=n.string();continue;case 2:if(18!==e)break;s.value=xr.unwrap(xr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Or.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={key:"",value:void 0};return r.key=null!=(t=e.key)?t:"",r.value=null!=(n=e.value)?n:void 0,r}},xr={encode:(e,t=new Nr)=>(void 0!==e.nullValue&&t.uint32(8).int32(e.nullValue),void 0!==e.numberValue&&t.uint32(17).double(e.numberValue),void 0!==e.stringValue&&t.uint32(26).string(e.stringValue),void 0!==e.boolValue&&t.uint32(32).bool(e.boolValue),void 0!==e.structValue&&Cr.encode(Cr.wrap(e.structValue),t.uint32(42).fork()).join(),void 0!==e.listValue&&Rr.encode(Rr.wrap(e.listValue),t.uint32(50).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;s.nullValue=n.int32();continue;case 2:if(17!==e)break;s.numberValue=n.double();continue;case 3:if(26!==e)break;s.stringValue=n.string();continue;case 4:if(32!==e)break;s.boolValue=n.bool();continue;case 5:if(42!==e)break;s.structValue=Cr.unwrap(Cr.decode(n,n.uint32()));continue;case 6:if(50!==e)break;s.listValue=Rr.unwrap(Rr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>xr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r,s,a,i;const o={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};return o.nullValue=null!=(t=e.nullValue)?t:void 0,o.numberValue=null!=(n=e.numberValue)?n:void 0,o.stringValue=null!=(r=e.stringValue)?r:void 0,o.boolValue=null!=(s=e.boolValue)?s:void 0,o.structValue=null!=(a=e.structValue)?a:void 0,o.listValue=null!=(i=e.listValue)?i:void 0,o},wrap(e){const t={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};if(null===e)t.nullValue=0;else if("boolean"==typeof e)t.boolValue=e;else if("number"==typeof e)t.numberValue=e;else if("string"==typeof e)t.stringValue=e;else if(globalThis.Array.isArray(e))t.listValue=e;else if("object"==typeof e)t.structValue=e;else if(void 0!==e)throw new globalThis.Error("Unsupported any value type: "+typeof e);return t},unwrap:e=>void 0!==e.stringValue?e.stringValue:void 0!==(null==e?void 0:e.numberValue)?e.numberValue:void 0!==(null==e?void 0:e.boolValue)?e.boolValue:void 0!==(null==e?void 0:e.structValue)?e.structValue:void 0!==(null==e?void 0:e.listValue)?e.listValue:void 0!==(null==e?void 0:e.nullValue)?null:void 0},Rr={encode(e,t=new Nr){for(const n of e.values)xr.encode(xr.wrap(n),t.uint32(10).fork()).join();return t},decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={values:[]};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.values.push(xr.unwrap(xr.decode(n,n.uint32())));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Rr.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={values:[]};return n.values=(null==(t=e.values)?void 0:t.map(e=>e))||[],n},wrap(e){const t={values:[]};return t.values=null!=e?e:[],t},unwrap:e=>(null==e?void 0:e.hasOwnProperty("values"))&&globalThis.Array.isArray(e.values)?e.values:e},Pr=(e=>(e[e.ADD=0]="ADD",e[e.REMOVE=1]="REMOVE",e[e.REPLACE=2]="REPLACE",e[e.MOVE=3]="MOVE",e[e.COPY=4]="COPY",e[e.TEST=5]="TEST",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(Pr||{}),Lr={encode:(e,t=new Nr)=>(0!==e.op&&t.uint32(8).int32(e.op),""!==e.path&&t.uint32(18).string(e.path),void 0!==e.from&&t.uint32(26).string(e.from),void 0!==e.value&&xr.encode(xr.wrap(e.value),t.uint32(34).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={op:0,path:"",from:void 0,value:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;s.op=n.int32();continue;case 2:if(18!==e)break;s.path=n.string();continue;case 3:if(26!==e)break;s.from=n.string();continue;case 4:if(34!==e)break;s.value=xr.unwrap(xr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Lr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r,s;const a={op:0,path:"",from:void 0,value:void 0};return a.op=null!=(t=e.op)?t:0,a.path=null!=(n=e.path)?n:"",a.from=null!=(r=e.from)?r:void 0,a.value=null!=(s=e.value)?s:void 0,a}},Mr={encode:(e,t=new Nr)=>(""!==e.id&&t.uint32(10).string(e.id),""!==e.type&&t.uint32(18).string(e.type),void 0!==e.function&&Dr.encode(e.function,t.uint32(26).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={id:"",type:"",function:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.id=n.string();continue;case 2:if(18!==e)break;s.type=n.string();continue;case 3:if(26!==e)break;s.function=Dr.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Mr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={id:"",type:"",function:void 0};return r.id=null!=(t=e.id)?t:"",r.type=null!=(n=e.type)?n:"",r.function=void 0!==e.function&&null!==e.function?Dr.fromPartial(e.function):void 0,r}},Dr={encode:(e,t=new Nr)=>(""!==e.name&&t.uint32(10).string(e.name),""!==e.arguments&&t.uint32(18).string(e.arguments),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={name:"",arguments:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.name=n.string();continue;case 2:if(18!==e)break;s.arguments=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Dr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={name:"",arguments:""};return r.name=null!=(t=e.name)?t:"",r.arguments=null!=(n=e.arguments)?n:"",r}},jr={encode(e,t=new Nr){""!==e.id&&t.uint32(10).string(e.id),""!==e.role&&t.uint32(18).string(e.role),void 0!==e.content&&t.uint32(26).string(e.content),void 0!==e.name&&t.uint32(34).string(e.name);for(const n of e.toolCalls)Mr.encode(n,t.uint32(42).fork()).join();return void 0!==e.toolCallId&&t.uint32(50).string(e.toolCallId),t},decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={id:"",role:"",content:void 0,name:void 0,toolCalls:[],toolCallId:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.id=n.string();continue;case 2:if(18!==e)break;s.role=n.string();continue;case 3:if(26!==e)break;s.content=n.string();continue;case 4:if(34!==e)break;s.name=n.string();continue;case 5:if(42!==e)break;s.toolCalls.push(Mr.decode(n,n.uint32()));continue;case 6:if(50!==e)break;s.toolCallId=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>jr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r,s,a,i;const o={id:"",role:"",content:void 0,name:void 0,toolCalls:[],toolCallId:void 0};return o.id=null!=(t=e.id)?t:"",o.role=null!=(n=e.role)?n:"",o.content=null!=(r=e.content)?r:void 0,o.name=null!=(s=e.name)?s:void 0,o.toolCalls=(null==(a=e.toolCalls)?void 0:a.map(e=>Mr.fromPartial(e)))||[],o.toolCallId=null!=(i=e.toolCallId)?i:void 0,o}},Ur=(e=>(e[e.TEXT_MESSAGE_START=0]="TEXT_MESSAGE_START",e[e.TEXT_MESSAGE_CONTENT=1]="TEXT_MESSAGE_CONTENT",e[e.TEXT_MESSAGE_END=2]="TEXT_MESSAGE_END",e[e.TOOL_CALL_START=3]="TOOL_CALL_START",e[e.TOOL_CALL_ARGS=4]="TOOL_CALL_ARGS",e[e.TOOL_CALL_END=5]="TOOL_CALL_END",e[e.STATE_SNAPSHOT=6]="STATE_SNAPSHOT",e[e.STATE_DELTA=7]="STATE_DELTA",e[e.MESSAGES_SNAPSHOT=8]="MESSAGES_SNAPSHOT",e[e.RAW=9]="RAW",e[e.CUSTOM=10]="CUSTOM",e[e.RUN_STARTED=11]="RUN_STARTED",e[e.RUN_FINISHED=12]="RUN_FINISHED",e[e.RUN_ERROR=13]="RUN_ERROR",e[e.STEP_STARTED=14]="STEP_STARTED",e[e.STEP_FINISHED=15]="STEP_FINISHED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(Ur||{}),Gr={encode:(e,t=new Nr)=>(0!==e.type&&t.uint32(8).int32(e.type),void 0!==e.timestamp&&t.uint32(16).int64(e.timestamp),void 0!==e.rawEvent&&xr.encode(xr.wrap(e.rawEvent),t.uint32(26).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={type:0,timestamp:void 0,rawEvent:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;s.type=n.int32();continue;case 2:if(16!==e)break;s.timestamp=as(n.int64());continue;case 3:if(26!==e)break;s.rawEvent=xr.unwrap(xr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Gr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r;const s={type:0,timestamp:void 0,rawEvent:void 0};return s.type=null!=(t=e.type)?t:0,s.timestamp=null!=(n=e.timestamp)?n:void 0,s.rawEvent=null!=(r=e.rawEvent)?r:void 0,s}},Fr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.messageId&&t.uint32(18).string(e.messageId),void 0!==e.role&&t.uint32(26).string(e.role),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,messageId:"",role:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.messageId=n.string();continue;case 3:if(26!==e)break;s.role=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Fr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,messageId:"",role:void 0};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.messageId=null!=(t=e.messageId)?t:"",r.role=null!=(n=e.role)?n:void 0,r}},Zr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.messageId&&t.uint32(18).string(e.messageId),""!==e.delta&&t.uint32(26).string(e.delta),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,messageId:"",delta:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.messageId=n.string();continue;case 3:if(26!==e)break;s.delta=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Zr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,messageId:"",delta:""};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.messageId=null!=(t=e.messageId)?t:"",r.delta=null!=(n=e.delta)?n:"",r}},Vr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.messageId&&t.uint32(18).string(e.messageId),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,messageId:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.messageId=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Vr.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,messageId:""};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.messageId=null!=(t=e.messageId)?t:"",n}},Hr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.toolCallId&&t.uint32(18).string(e.toolCallId),""!==e.toolCallName&&t.uint32(26).string(e.toolCallName),void 0!==e.parentMessageId&&t.uint32(34).string(e.parentMessageId),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,toolCallId:"",toolCallName:"",parentMessageId:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.toolCallId=n.string();continue;case 3:if(26!==e)break;s.toolCallName=n.string();continue;case 4:if(34!==e)break;s.parentMessageId=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Hr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r;const s={baseEvent:void 0,toolCallId:"",toolCallName:"",parentMessageId:void 0};return s.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,s.toolCallId=null!=(t=e.toolCallId)?t:"",s.toolCallName=null!=(n=e.toolCallName)?n:"",s.parentMessageId=null!=(r=e.parentMessageId)?r:void 0,s}},$r={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.toolCallId&&t.uint32(18).string(e.toolCallId),""!==e.delta&&t.uint32(26).string(e.delta),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,toolCallId:"",delta:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.toolCallId=n.string();continue;case 3:if(26!==e)break;s.delta=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>$r.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,toolCallId:"",delta:""};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.toolCallId=null!=(t=e.toolCallId)?t:"",r.delta=null!=(n=e.delta)?n:"",r}},Kr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.toolCallId&&t.uint32(18).string(e.toolCallId),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,toolCallId:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.toolCallId=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Kr.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,toolCallId:""};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.toolCallId=null!=(t=e.toolCallId)?t:"",n}},Xr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),void 0!==e.snapshot&&xr.encode(xr.wrap(e.snapshot),t.uint32(18).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,snapshot:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.snapshot=xr.unwrap(xr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Xr.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,snapshot:void 0};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.snapshot=null!=(t=e.snapshot)?t:void 0,n}},Br={encode(e,t=new Nr){void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join();for(const n of e.delta)Lr.encode(n,t.uint32(18).fork()).join();return t},decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,delta:[]};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.delta.push(Lr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Br.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,delta:[]};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.delta=(null==(t=e.delta)?void 0:t.map(e=>Lr.fromPartial(e)))||[],n}},zr={encode(e,t=new Nr){void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join();for(const n of e.messages)jr.encode(n,t.uint32(18).fork()).join();return t},decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,messages:[]};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.messages.push(jr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>zr.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,messages:[]};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.messages=(null==(t=e.messages)?void 0:t.map(e=>jr.fromPartial(e)))||[],n}},Jr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),void 0!==e.event&&xr.encode(xr.wrap(e.event),t.uint32(18).fork()).join(),void 0!==e.source&&t.uint32(26).string(e.source),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,event:void 0,source:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.event=xr.unwrap(xr.decode(n,n.uint32()));continue;case 3:if(26!==e)break;s.source=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Jr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,event:void 0,source:void 0};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.event=null!=(t=e.event)?t:void 0,r.source=null!=(n=e.source)?n:void 0,r}},Wr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.name&&t.uint32(18).string(e.name),void 0!==e.value&&xr.encode(xr.wrap(e.value),t.uint32(26).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,name:"",value:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.name=n.string();continue;case 3:if(26!==e)break;s.value=xr.unwrap(xr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Wr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,name:"",value:void 0};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.name=null!=(t=e.name)?t:"",r.value=null!=(n=e.value)?n:void 0,r}},qr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.threadId&&t.uint32(18).string(e.threadId),""!==e.runId&&t.uint32(26).string(e.runId),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,threadId:"",runId:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.threadId=n.string();continue;case 3:if(26!==e)break;s.runId=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>qr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,threadId:"",runId:""};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.threadId=null!=(t=e.threadId)?t:"",r.runId=null!=(n=e.runId)?n:"",r}},Yr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.threadId&&t.uint32(18).string(e.threadId),""!==e.runId&&t.uint32(26).string(e.runId),void 0!==e.result&&xr.encode(xr.wrap(e.result),t.uint32(34).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,threadId:"",runId:"",result:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.threadId=n.string();continue;case 3:if(26!==e)break;s.runId=n.string();continue;case 4:if(34!==e)break;s.result=xr.unwrap(xr.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Yr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r;const s={baseEvent:void 0,threadId:"",runId:"",result:void 0};return s.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,s.threadId=null!=(t=e.threadId)?t:"",s.runId=null!=(n=e.runId)?n:"",s.result=null!=(r=e.result)?r:void 0,s}},Qr={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),void 0!==e.code&&t.uint32(18).string(e.code),""!==e.message&&t.uint32(26).string(e.message),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,code:void 0,message:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.code=n.string();continue;case 3:if(26!==e)break;s.message=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>Qr.fromPartial(null!=e?e:{}),fromPartial(e){var t,n;const r={baseEvent:void 0,code:void 0,message:""};return r.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,r.code=null!=(t=e.code)?t:void 0,r.message=null!=(n=e.message)?n:"",r}},es={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.stepName&&t.uint32(18).string(e.stepName),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,stepName:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.stepName=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>es.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,stepName:""};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.stepName=null!=(t=e.stepName)?t:"",n}},ts={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),""!==e.stepName&&t.uint32(18).string(e.stepName),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,stepName:""};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.stepName=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>ts.fromPartial(null!=e?e:{}),fromPartial(e){var t;const n={baseEvent:void 0,stepName:""};return n.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,n.stepName=null!=(t=e.stepName)?t:"",n}},ns={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),void 0!==e.messageId&&t.uint32(18).string(e.messageId),void 0!==e.role&&t.uint32(26).string(e.role),void 0!==e.delta&&t.uint32(34).string(e.delta),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,messageId:void 0,role:void 0,delta:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.messageId=n.string();continue;case 3:if(26!==e)break;s.role=n.string();continue;case 4:if(34!==e)break;s.delta=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>ns.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r;const s={baseEvent:void 0,messageId:void 0,role:void 0,delta:void 0};return s.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,s.messageId=null!=(t=e.messageId)?t:void 0,s.role=null!=(n=e.role)?n:void 0,s.delta=null!=(r=e.delta)?r:void 0,s}},rs={encode:(e,t=new Nr)=>(void 0!==e.baseEvent&&Gr.encode(e.baseEvent,t.uint32(10).fork()).join(),void 0!==e.toolCallId&&t.uint32(18).string(e.toolCallId),void 0!==e.toolCallName&&t.uint32(26).string(e.toolCallName),void 0!==e.parentMessageId&&t.uint32(34).string(e.parentMessageId),void 0!==e.delta&&t.uint32(42).string(e.delta),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={baseEvent:void 0,toolCallId:void 0,toolCallName:void 0,parentMessageId:void 0,delta:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.baseEvent=Gr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.toolCallId=n.string();continue;case 3:if(26!==e)break;s.toolCallName=n.string();continue;case 4:if(34!==e)break;s.parentMessageId=n.string();continue;case 5:if(42!==e)break;s.delta=n.string();continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>rs.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r,s;const a={baseEvent:void 0,toolCallId:void 0,toolCallName:void 0,parentMessageId:void 0,delta:void 0};return a.baseEvent=void 0!==e.baseEvent&&null!==e.baseEvent?Gr.fromPartial(e.baseEvent):void 0,a.toolCallId=null!=(t=e.toolCallId)?t:void 0,a.toolCallName=null!=(n=e.toolCallName)?n:void 0,a.parentMessageId=null!=(r=e.parentMessageId)?r:void 0,a.delta=null!=(s=e.delta)?s:void 0,a}},ss={encode:(e,t=new Nr)=>(void 0!==e.textMessageStart&&Fr.encode(e.textMessageStart,t.uint32(10).fork()).join(),void 0!==e.textMessageContent&&Zr.encode(e.textMessageContent,t.uint32(18).fork()).join(),void 0!==e.textMessageEnd&&Vr.encode(e.textMessageEnd,t.uint32(26).fork()).join(),void 0!==e.toolCallStart&&Hr.encode(e.toolCallStart,t.uint32(34).fork()).join(),void 0!==e.toolCallArgs&&$r.encode(e.toolCallArgs,t.uint32(42).fork()).join(),void 0!==e.toolCallEnd&&Kr.encode(e.toolCallEnd,t.uint32(50).fork()).join(),void 0!==e.stateSnapshot&&Xr.encode(e.stateSnapshot,t.uint32(58).fork()).join(),void 0!==e.stateDelta&&Br.encode(e.stateDelta,t.uint32(66).fork()).join(),void 0!==e.messagesSnapshot&&zr.encode(e.messagesSnapshot,t.uint32(74).fork()).join(),void 0!==e.raw&&Jr.encode(e.raw,t.uint32(82).fork()).join(),void 0!==e.custom&&Wr.encode(e.custom,t.uint32(90).fork()).join(),void 0!==e.runStarted&&qr.encode(e.runStarted,t.uint32(98).fork()).join(),void 0!==e.runFinished&&Yr.encode(e.runFinished,t.uint32(106).fork()).join(),void 0!==e.runError&&Qr.encode(e.runError,t.uint32(114).fork()).join(),void 0!==e.stepStarted&&es.encode(e.stepStarted,t.uint32(122).fork()).join(),void 0!==e.stepFinished&&ts.encode(e.stepFinished,t.uint32(130).fork()).join(),void 0!==e.textMessageChunk&&ns.encode(e.textMessageChunk,t.uint32(138).fork()).join(),void 0!==e.toolCallChunk&&rs.encode(e.toolCallChunk,t.uint32(146).fork()).join(),t),decode(e,t){const n=e instanceof kr?e:new kr(e);let r=void 0===t?n.len:n.pos+t;const s={textMessageStart:void 0,textMessageContent:void 0,textMessageEnd:void 0,toolCallStart:void 0,toolCallArgs:void 0,toolCallEnd:void 0,stateSnapshot:void 0,stateDelta:void 0,messagesSnapshot:void 0,raw:void 0,custom:void 0,runStarted:void 0,runFinished:void 0,runError:void 0,stepStarted:void 0,stepFinished:void 0,textMessageChunk:void 0,toolCallChunk:void 0};for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;s.textMessageStart=Fr.decode(n,n.uint32());continue;case 2:if(18!==e)break;s.textMessageContent=Zr.decode(n,n.uint32());continue;case 3:if(26!==e)break;s.textMessageEnd=Vr.decode(n,n.uint32());continue;case 4:if(34!==e)break;s.toolCallStart=Hr.decode(n,n.uint32());continue;case 5:if(42!==e)break;s.toolCallArgs=$r.decode(n,n.uint32());continue;case 6:if(50!==e)break;s.toolCallEnd=Kr.decode(n,n.uint32());continue;case 7:if(58!==e)break;s.stateSnapshot=Xr.decode(n,n.uint32());continue;case 8:if(66!==e)break;s.stateDelta=Br.decode(n,n.uint32());continue;case 9:if(74!==e)break;s.messagesSnapshot=zr.decode(n,n.uint32());continue;case 10:if(82!==e)break;s.raw=Jr.decode(n,n.uint32());continue;case 11:if(90!==e)break;s.custom=Wr.decode(n,n.uint32());continue;case 12:if(98!==e)break;s.runStarted=qr.decode(n,n.uint32());continue;case 13:if(106!==e)break;s.runFinished=Yr.decode(n,n.uint32());continue;case 14:if(114!==e)break;s.runError=Qr.decode(n,n.uint32());continue;case 15:if(122!==e)break;s.stepStarted=es.decode(n,n.uint32());continue;case 16:if(130!==e)break;s.stepFinished=ts.decode(n,n.uint32());continue;case 17:if(138!==e)break;s.textMessageChunk=ns.decode(n,n.uint32());continue;case 18:if(146!==e)break;s.toolCallChunk=rs.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skip(7&e)}return s},create:e=>ss.fromPartial(null!=e?e:{}),fromPartial(e){const t={textMessageStart:void 0,textMessageContent:void 0,textMessageEnd:void 0,toolCallStart:void 0,toolCallArgs:void 0,toolCallEnd:void 0,stateSnapshot:void 0,stateDelta:void 0,messagesSnapshot:void 0,raw:void 0,custom:void 0,runStarted:void 0,runFinished:void 0,runError:void 0,stepStarted:void 0,stepFinished:void 0,textMessageChunk:void 0,toolCallChunk:void 0};return t.textMessageStart=void 0!==e.textMessageStart&&null!==e.textMessageStart?Fr.fromPartial(e.textMessageStart):void 0,t.textMessageContent=void 0!==e.textMessageContent&&null!==e.textMessageContent?Zr.fromPartial(e.textMessageContent):void 0,t.textMessageEnd=void 0!==e.textMessageEnd&&null!==e.textMessageEnd?Vr.fromPartial(e.textMessageEnd):void 0,t.toolCallStart=void 0!==e.toolCallStart&&null!==e.toolCallStart?Hr.fromPartial(e.toolCallStart):void 0,t.toolCallArgs=void 0!==e.toolCallArgs&&null!==e.toolCallArgs?$r.fromPartial(e.toolCallArgs):void 0,t.toolCallEnd=void 0!==e.toolCallEnd&&null!==e.toolCallEnd?Kr.fromPartial(e.toolCallEnd):void 0,t.stateSnapshot=void 0!==e.stateSnapshot&&null!==e.stateSnapshot?Xr.fromPartial(e.stateSnapshot):void 0,t.stateDelta=void 0!==e.stateDelta&&null!==e.stateDelta?Br.fromPartial(e.stateDelta):void 0,t.messagesSnapshot=void 0!==e.messagesSnapshot&&null!==e.messagesSnapshot?zr.fromPartial(e.messagesSnapshot):void 0,t.raw=void 0!==e.raw&&null!==e.raw?Jr.fromPartial(e.raw):void 0,t.custom=void 0!==e.custom&&null!==e.custom?Wr.fromPartial(e.custom):void 0,t.runStarted=void 0!==e.runStarted&&null!==e.runStarted?qr.fromPartial(e.runStarted):void 0,t.runFinished=void 0!==e.runFinished&&null!==e.runFinished?Yr.fromPartial(e.runFinished):void 0,t.runError=void 0!==e.runError&&null!==e.runError?Qr.fromPartial(e.runError):void 0,t.stepStarted=void 0!==e.stepStarted&&null!==e.stepStarted?es.fromPartial(e.stepStarted):void 0,t.stepFinished=void 0!==e.stepFinished&&null!==e.stepFinished?ts.fromPartial(e.stepFinished):void 0,t.textMessageChunk=void 0!==e.textMessageChunk&&null!==e.textMessageChunk?ns.fromPartial(e.textMessageChunk):void 0,t.toolCallChunk=void 0!==e.toolCallChunk&&null!==e.toolCallChunk?rs.fromPartial(e.toolCallChunk):void 0,t}};function as(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function is(e){var t;const n=ss.decode(e),r=Object.values(n).find(e=>void 0!==e);if(!r)throw new Error("Invalid event");if(r.type=Ur[r.baseEvent.type],r.timestamp=r.baseEvent.timestamp,r.rawEvent=r.baseEvent.rawEvent,r.type===Qe.MESSAGES_SNAPSHOT)for(const e of r.messages){const n=e;0===(null==(t=n.toolCalls)?void 0:t.length)&&(n.toolCalls=void 0)}if(r.type===Qe.STATE_DELTA)for(const e of r.delta)e.op=Pr[e.op].toLowerCase(),Object.keys(e).forEach(t=>{void 0===e[t]&&delete e[t]});return Object.keys(r).forEach(e=>{void 0===r[e]&&delete r[e]}),pt.parse(r)}const os={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let us;const ls=new Uint8Array(16),cs=[];for(let e=0;e<256;++e)cs.push((e+256).toString(16).slice(1));const ds=function(e,t,n){if(os.randomUUID&&!t&&!e)return os.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!us){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");us=crypto.getRandomValues.bind(crypto)}return us(ls)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return(cs[e[t+0]]+cs[e[t+1]]+cs[e[t+2]]+cs[e[t+3]]+"-"+cs[e[t+4]]+cs[e[t+5]]+"-"+cs[e[t+6]]+cs[e[t+7]]+"-"+cs[e[t+8]]+cs[e[t+9]]+"-"+cs[e[t+10]]+cs[e[t+11]]+cs[e[t+12]]+cs[e[t+13]]+cs[e[t+14]]+cs[e[t+15]]).toLowerCase()}(r)};function fs(e){return vt(function(t,n){var r,s=null,a=!1;s=t.subscribe(Wt(n,void 0,void 0,function(i){r=hn(e(i,fs(e)(t))),s?(s.unsubscribe(),s=null,r.subscribe(n)):a=!0})),a&&(s.unsubscribe(),s=null,r.subscribe(n))})}function ps(e){return vt(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}var hs=wt(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}),vs=Object.defineProperty,ms=Object.defineProperties,gs=Object.getOwnPropertyDescriptors,_s=Object.getOwnPropertySymbols,bs=Object.prototype.hasOwnProperty,ys=Object.prototype.propertyIsEnumerable,Es=(e,t,n)=>t in e?vs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ts=(e,t)=>{for(var n in t||(t={}))bs.call(t,n)&&Es(e,n,t[n]);if(_s)for(var n of _s(t))ys.call(t,n)&&Es(e,n,t[n]);return e},ws=(e,t)=>ms(e,gs(t)),Ss=e=>{if("function"==typeof structuredClone)return structuredClone(e);try{return JSON.parse(JSON.stringify(e))}catch(t){return Ts({},e)}};async function Ns(e,t,n,r){let s,a=t,i=n;for(let t of e)try{let e=await r(t,Ss(a),Ss(i));if(void 0===e)continue;if(void 0!==e.messages&&(a=e.messages),void 0!==e.state&&(i=e.state),s=e.stopPropagation,!0===s)break}catch(e){void 0!==process.env.JEST_WORKER_ID||console.error("Subscriber error:",e);continue}return Ts(Ts(Ts({},JSON.stringify(a)!==JSON.stringify(t)?{messages:a}:{}),JSON.stringify(i)!==JSON.stringify(n)?{state:i}:{}),void 0!==s?{stopPropagation:s}:{})}var ks=e=>t=>{let n,r,s=!1,a=!1,i=!1,o=new Map,u=!1,l=!1;return t.pipe(gn(t=>{let c=t.type;if(e&&console.debug("[VERIFY]:",JSON.stringify(t)),a)return nr(()=>new Ye(`Cannot send event type '${c}': The run has already errored with 'RUN_ERROR'. No further events can be sent.`));if(s&&c!==Qe.RUN_ERROR)return nr(()=>new Ye(`Cannot send event type '${c}': The run has already finished with 'RUN_FINISHED'. Start a new run with 'RUN_STARTED'.`));if(void 0!==n&&![Qe.TEXT_MESSAGE_CONTENT,Qe.TEXT_MESSAGE_END,Qe.RAW].includes(c))return nr(()=>new Ye(`Cannot send event type '${c}' after 'TEXT_MESSAGE_START': Send 'TEXT_MESSAGE_END' first.`));if(void 0!==r&&![Qe.TOOL_CALL_ARGS,Qe.TOOL_CALL_END,Qe.RAW].includes(c))return c===Qe.TOOL_CALL_START?nr(()=>new Ye("Cannot send 'TOOL_CALL_START' event: A tool call is already in progress. Complete it with 'TOOL_CALL_END' first.")):nr(()=>new Ye(`Cannot send event type '${c}' after 'TOOL_CALL_START': Send 'TOOL_CALL_END' first.`));if(i){if(c===Qe.RUN_STARTED)return nr(()=>new Ye("Cannot send multiple 'RUN_STARTED' events: A 'RUN_STARTED' event was already sent. Each run must have exactly one 'RUN_STARTED' event at the beginning."))}else if(i=!0,c!==Qe.RUN_STARTED&&c!==Qe.RUN_ERROR)return nr(()=>new Ye("First event must be 'RUN_STARTED'"));switch(c){case Qe.TEXT_MESSAGE_START:return void 0!==n?nr(()=>new Ye("Cannot send 'TEXT_MESSAGE_START' event: A text message is already in progress. Complete it with 'TEXT_MESSAGE_END' first.")):(n=t.messageId,Tn(t));case Qe.TEXT_MESSAGE_CONTENT:return void 0===n?nr(()=>new Ye("Cannot send 'TEXT_MESSAGE_CONTENT' event: No active text message found. Start a text message with 'TEXT_MESSAGE_START' first.")):t.messageId!==n?nr(()=>new Ye(`Cannot send 'TEXT_MESSAGE_CONTENT' event: Message ID mismatch. The ID '${t.messageId}' doesn't match the active message ID '${n}'.`)):Tn(t);case Qe.TEXT_MESSAGE_END:return void 0===n?nr(()=>new Ye("Cannot send 'TEXT_MESSAGE_END' event: No active text message found. A 'TEXT_MESSAGE_START' event must be sent first.")):t.messageId!==n?nr(()=>new Ye(`Cannot send 'TEXT_MESSAGE_END' event: Message ID mismatch. The ID '${t.messageId}' doesn't match the active message ID '${n}'.`)):(n=void 0,Tn(t));case Qe.TOOL_CALL_START:return void 0!==r?nr(()=>new Ye("Cannot send 'TOOL_CALL_START' event: A tool call is already in progress. Complete it with 'TOOL_CALL_END' first.")):(r=t.toolCallId,Tn(t));case Qe.TOOL_CALL_ARGS:return void 0===r?nr(()=>new Ye("Cannot send 'TOOL_CALL_ARGS' event: No active tool call found. Start a tool call with 'TOOL_CALL_START' first.")):t.toolCallId!==r?nr(()=>new Ye(`Cannot send 'TOOL_CALL_ARGS' event: Tool call ID mismatch. The ID '${t.toolCallId}' doesn't match the active tool call ID '${r}'.`)):Tn(t);case Qe.TOOL_CALL_END:return void 0===r?nr(()=>new Ye("Cannot send 'TOOL_CALL_END' event: No active tool call found. A 'TOOL_CALL_START' event must be sent first.")):t.toolCallId!==r?nr(()=>new Ye(`Cannot send 'TOOL_CALL_END' event: Tool call ID mismatch. The ID '${t.toolCallId}' doesn't match the active tool call ID '${r}'.`)):(r=void 0,Tn(t));case Qe.STEP_STARTED:{let e=t.stepName;return o.has(e)?nr(()=>new Ye(`Step "${e}" is already active for 'STEP_STARTED'`)):(o.set(e,!0),Tn(t))}case Qe.STEP_FINISHED:{let e=t.stepName;return o.has(e)?(o.delete(e),Tn(t)):nr(()=>new Ye(`Cannot send 'STEP_FINISHED' for step "${e}" that was not started`))}case Qe.RUN_STARTED:return Tn(t);case Qe.RUN_FINISHED:if(o.size>0){let e=Array.from(o.keys()).join(", ");return nr(()=>new Ye(`Cannot send 'RUN_FINISHED' while steps are still active: ${e}`))}return s=!0,Tn(t);case Qe.RUN_ERROR:return a=!0,Tn(t);case Qe.CUSTOM:return Tn(t);case Qe.THINKING_TEXT_MESSAGE_START:return u?l?nr(()=>new Ye("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking message is already in progress. Complete it with 'THINKING_TEXT_MESSAGE_END' first.")):(l=!0,Tn(t)):nr(()=>new Ye("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking step is not in progress. Create one with 'THINKING_START' first."));case Qe.THINKING_TEXT_MESSAGE_CONTENT:return l?Tn(t):nr(()=>new Ye("Cannot send 'THINKING_TEXT_MESSAGE_CONTENT' event: No active thinking message found. Start a message with 'THINKING_TEXT_MESSAGE_START' first."));case Qe.THINKING_TEXT_MESSAGE_END:return l?(l=!1,Tn(t)):nr(()=>new Ye("Cannot send 'THINKING_TEXT_MESSAGE_END' event: No active thinking message found. A 'THINKING_TEXT_MESSAGE_START' event must be sent first."));case Qe.THINKING_START:return u?nr(()=>new Ye("Cannot send 'THINKING_START' event: A thinking step is already in progress. End it with 'THINKING_END' first.")):(u=!0,Tn(t));case Qe.THINKING_END:return u?(u=!1,Tn(t)):nr(()=>new Ye("Cannot send 'THINKING_END' event: No active thinking step found. A 'THINKING_START' event must be sent first."));default:return Tn(t)}}))},As=He(["TextMessageStart","TextMessageContent","TextMessageEnd","ActionExecutionStart","ActionExecutionArgs","ActionExecutionEnd","ActionExecutionResult","AgentStateMessage","MetaEvent","RunStarted","RunFinished","RunError","NodeStarted","NodeFinished"]),Is=He(["LangGraphInterruptEvent","PredictState","Exit"]);function Cs(e){var t;let n=[];for(let r of e)if("assistant"===r.role||"user"===r.role||"system"===r.role){if(r.content){let e={id:r.id,role:r.role,content:r.content};n.push(e)}if("assistant"===r.role&&r.toolCalls&&r.toolCalls.length>0)for(let e of r.toolCalls){let t={id:e.id,name:e.function.name,arguments:JSON.parse(e.function.arguments),parentMessageId:r.id};n.push(t)}}else if("tool"===r.role){let s="unknown";for(let n of e)if("assistant"===n.role&&null!=(t=n.toolCalls)&&t.length)for(let e of n.toolCalls)if(e.id===r.toolCallId){s=e.function.name;break}let a={id:r.id,result:r.content,actionExecutionId:r.toolCallId,actionName:s};n.push(a)}return n}Ze("type",[Ge({type:Ve(As.enum.TextMessageStart),messageId:Le(),parentMessageId:Le().optional()}),Ge({type:Ve(As.enum.TextMessageContent),messageId:Le(),content:Le()}),Ge({type:Ve(As.enum.TextMessageEnd),messageId:Le()}),Ge({type:Ve(As.enum.ActionExecutionStart),actionExecutionId:Le(),actionName:Le(),parentMessageId:Le().optional()}),Ge({type:Ve(As.enum.ActionExecutionArgs),actionExecutionId:Le(),args:Le()}),Ge({type:Ve(As.enum.ActionExecutionEnd),actionExecutionId:Le()}),Ge({type:Ve(As.enum.ActionExecutionResult),actionName:Le(),actionExecutionId:Le(),result:Le()}),Ge({type:Ve(As.enum.AgentStateMessage),threadId:Le(),agentName:Le(),nodeName:Le(),runId:Le(),active:De(),role:Le(),state:Le(),running:De()}),Ge({type:Ve(As.enum.MetaEvent),name:Is,value:je()})]),Ge({id:Le(),role:Le(),content:Le(),parentMessageId:Le().optional()}),Ge({id:Le(),name:Le(),arguments:je(),parentMessageId:Le().optional()}),Ge({id:Le(),result:je(),actionExecutionId:Le(),actionName:Le()});var Os=e=>t=>{let n,r,s,a=()=>{if(!n||"text"!==s)throw new Error("No text message to close");let t={type:Qe.TEXT_MESSAGE_END,messageId:n.messageId};return s=void 0,n=void 0,e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_END",JSON.stringify(t)),t},i=()=>{if(!r||"tool"!==s)throw new Error("No tool call to close");let t={type:Qe.TOOL_CALL_END,toolCallId:r.toolCallId};return s=void 0,r=void 0,e&&console.debug("[TRANSFORM]: TOOL_CALL_END",JSON.stringify(t)),t},o=()=>"text"===s?[a()]:"tool"===s?[i()]:[];return t.pipe(gn(t=>{switch(t.type){case Qe.TEXT_MESSAGE_START:case Qe.TEXT_MESSAGE_CONTENT:case Qe.TEXT_MESSAGE_END:case Qe.TOOL_CALL_START:case Qe.TOOL_CALL_ARGS:case Qe.TOOL_CALL_END:case Qe.TOOL_CALL_RESULT:case Qe.STATE_SNAPSHOT:case Qe.STATE_DELTA:case Qe.MESSAGES_SNAPSHOT:case Qe.CUSTOM:case Qe.RUN_STARTED:case Qe.RUN_FINISHED:case Qe.RUN_ERROR:case Qe.STEP_STARTED:case Qe.STEP_FINISHED:case Qe.THINKING_START:case Qe.THINKING_END:case Qe.THINKING_TEXT_MESSAGE_START:case Qe.THINKING_TEXT_MESSAGE_CONTENT:case Qe.THINKING_TEXT_MESSAGE_END:return[...o(),t];case Qe.RAW:return[t];case Qe.TEXT_MESSAGE_CHUNK:let a=t,i=[];if(("text"!==s||void 0!==a.messageId&&a.messageId!==(null==n?void 0:n.messageId))&&i.push(...o()),"text"!==s){if(void 0===a.messageId)throw new Error("First TEXT_MESSAGE_CHUNK must have a messageId");n={messageId:a.messageId},s="text";let t={type:Qe.TEXT_MESSAGE_START,messageId:a.messageId,role:"assistant"};i.push(t),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_START",JSON.stringify(t))}if(void 0!==a.delta){let t={type:Qe.TEXT_MESSAGE_CONTENT,messageId:n.messageId,delta:a.delta};i.push(t),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_CONTENT",JSON.stringify(t))}return i;case Qe.TOOL_CALL_CHUNK:let u=t,l=[];if(("tool"!==s||void 0!==u.toolCallId&&u.toolCallId!==(null==r?void 0:r.toolCallId))&&l.push(...o()),"tool"!==s){if(void 0===u.toolCallId)throw new Error("First TOOL_CALL_CHUNK must have a toolCallId");if(void 0===u.toolCallName)throw new Error("First TOOL_CALL_CHUNK must have a toolCallName");r={toolCallId:u.toolCallId,toolCallName:u.toolCallName,parentMessageId:u.parentMessageId},s="tool";let t={type:Qe.TOOL_CALL_START,toolCallId:u.toolCallId,toolCallName:u.toolCallName,parentMessageId:u.parentMessageId};l.push(t),e&&console.debug("[TRANSFORM]: TOOL_CALL_START",JSON.stringify(t))}if(void 0!==u.delta){let t={type:Qe.TOOL_CALL_ARGS,toolCallId:r.toolCallId,delta:u.delta};l.push(t),e&&console.debug("[TRANSFORM]: TOOL_CALL_ARGS",JSON.stringify(t))}return l}t.type}),ps(()=>o()))},xs=class{constructor({agentId:e,description:t,threadId:n,initialMessages:r,initialState:s,debug:a}={}){this.debug=!1,this.subscribers=[],this.agentId=e,this.description=null!=t?t:"",this.threadId=null!=n?n:ds(),this.messages=Ss(null!=r?r:[]),this.state=Ss(null!=s?s:{}),this.debug=null!=a&&a}subscribe(e){return this.subscribers.push(e),{unsubscribe:()=>{this.subscribers=this.subscribers.filter(t=>t!==e)}}}async runAgent(e,t){var n;this.agentId=null!=(n=this.agentId)?n:ds();let r,s=this.prepareRunAgentInput(e),a=new Set(this.messages.map(e=>e.id)),i=[{onRunFinishedEvent:e=>{r=e.result}},...this.subscribers,null!=t?t:{}];await this.onInitialize(s,i);let o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return rn(e)}(()=>this.run(s),Os(this.debug),ks(this.debug),e=>this.apply(s,e,i),e=>this.processApplyEvents(s,e,i),fs(e=>this.onError(s,e,i)),ps(()=>{this.onFinalize(s,i)}));return(u=o(Tn(null)),new Promise(function(e,t){var n,r=!1;u.subscribe({next:function(e){n=e,r=!0},error:t,complete:function(){r?e(n):t(new hs)}})})).then(()=>{let e=Ss(this.messages).filter(e=>!a.has(e.id));return{result:r,newMessages:e}});var u}abortRun(){}apply(e,t,n){return((e,t,n,r)=>{let s=Ss(e.messages),a=Ss(e.state),i={},o=e=>{void 0!==e.messages&&(s=e.messages,i.messages=e.messages),void 0!==e.state&&(a=e.state,i.state=e.state)},u=()=>{let e=Ss(i);return i={},void 0!==e.messages||void 0!==e.state?Tn(e):wn};return t.pipe((d=async t=>{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onEvent)?void 0:i.call(r,{event:t,agent:n,input:e,messages:s,state:a})});if(o(i),!0===i.stopPropagation)return u();switch(t.type){case Qe.TEXT_MESSAGE_START:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onTextMessageStartEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});if(o(i),!0!==i.stopPropagation){let{messageId:e,role:n}=t,r={id:e,role:n,content:""};s.push(r),o({messages:s})}return u()}case Qe.TEXT_MESSAGE_CONTENT:{let i=await Ns(r,s,a,(r,s,a)=>{var i,o;return null==(o=r.onTextMessageContentEvent)?void 0:o.call(r,{event:t,messages:s,state:a,agent:n,input:e,textMessageBuffer:null!=(i=s[s.length-1].content)?i:""})});if(o(i),!0!==i.stopPropagation){let{delta:e}=t,n=s[s.length-1];n.content=n.content+e,o({messages:s})}return u()}case Qe.TEXT_MESSAGE_END:{let i=await Ns(r,s,a,(r,s,a)=>{var i,o;return null==(o=r.onTextMessageEndEvent)?void 0:o.call(r,{event:t,messages:s,state:a,agent:n,input:e,textMessageBuffer:null!=(i=s[s.length-1].content)?i:""})});return o(i),await Promise.all(r.map(t=>{var r;null==(r=t.onNewMessage)||r.call(t,{message:s[s.length-1],messages:s,state:a,agent:n,input:e})})),u()}case Qe.TOOL_CALL_START:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onToolCallStartEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});if(o(i),!0!==i.stopPropagation){let e,{toolCallId:n,toolCallName:r,parentMessageId:a}=t;a&&s.length>0&&s[s.length-1].id===a?e=s[s.length-1]:(e={id:a||n,role:"assistant",toolCalls:[]},s.push(e)),null!=e.toolCalls||(e.toolCalls=[]),e.toolCalls.push({id:n,type:"function",function:{name:r,arguments:""}}),o({messages:s})}return u()}case Qe.TOOL_CALL_ARGS:{let i=await Ns(r,s,a,(r,s,a)=>{var i,o,u;let l=null!=(o=null==(i=s[s.length-1])?void 0:i.toolCalls)?o:[],c=l.length>0?l[l.length-1].function.arguments:"",d=l.length>0?l[l.length-1].function.name:"",f={};try{f=tr(c)}catch(e){}return null==(u=r.onToolCallArgsEvent)?void 0:u.call(r,{event:t,messages:s,state:a,agent:n,input:e,toolCallBuffer:c,toolCallName:d,partialToolCallArgs:f})});if(o(i),!0!==i.stopPropagation){let{delta:e}=t,n=s[s.length-1];n.toolCalls[n.toolCalls.length-1].function.arguments+=e,o({messages:s})}return u()}case Qe.TOOL_CALL_END:{let i=await Ns(r,s,a,(r,s,a)=>{var i,o,u;let l=null!=(o=null==(i=s[s.length-1])?void 0:i.toolCalls)?o:[],c=l.length>0?l[l.length-1].function.arguments:"",d=l.length>0?l[l.length-1].function.name:"",f={};try{f=JSON.parse(c)}catch(e){}return null==(u=r.onToolCallEndEvent)?void 0:u.call(r,{event:t,messages:s,state:a,agent:n,input:e,toolCallName:d,toolCallArgs:f})});return o(i),await Promise.all(r.map(t=>{var r;null==(r=t.onNewToolCall)||r.call(t,{toolCall:s[s.length-1].toolCalls[s[s.length-1].toolCalls.length-1],messages:s,state:a,agent:n,input:e})})),u()}case Qe.TOOL_CALL_RESULT:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onToolCallResultEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});if(o(i),!0!==i.stopPropagation){let{messageId:i,toolCallId:u,content:l,role:c}=t,d={id:i,toolCallId:u,role:c||"tool",content:l};s.push(d),await Promise.all(r.map(t=>{var r;null==(r=t.onNewMessage)||r.call(t,{message:d,messages:s,state:a,agent:n,input:e})})),o({messages:s})}return u()}case Qe.STATE_SNAPSHOT:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onStateSnapshotEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});if(o(i),!0!==i.stopPropagation){let{snapshot:e}=t;a=e,o({state:a})}return u()}case Qe.STATE_DELTA:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onStateDeltaEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});if(o(i),!0!==i.stopPropagation){let{delta:e}=t;try{a=Zn(a,e,!0,!1).newDocument,o({state:a})}catch(t){let n=t instanceof Error?t.message:String(t);console.warn(`Failed to apply state patch:\nCurrent state: ${JSON.stringify(a,null,2)}\nPatch operations: ${JSON.stringify(e,null,2)}\nError: ${n}`)}}return u()}case Qe.MESSAGES_SNAPSHOT:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onMessagesSnapshotEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});if(o(i),!0!==i.stopPropagation){let{messages:e}=t;s=e,o({messages:s})}return u()}case Qe.RAW:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onRawEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});return o(i),u()}case Qe.CUSTOM:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onCustomEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});return o(i),u()}case Qe.RUN_STARTED:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onRunStartedEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});return o(i),u()}case Qe.RUN_FINISHED:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onRunFinishedEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e,result:t.result})});return o(i),u()}case Qe.RUN_ERROR:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onRunErrorEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});return o(i),u()}case Qe.STEP_STARTED:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onStepStartedEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});return o(i),u()}case Qe.STEP_FINISHED:{let i=await Ns(r,s,a,(r,s,a)=>{var i;return null==(i=r.onStepFinishedEvent)?void 0:i.call(r,{event:t,messages:s,state:a,agent:n,input:e})});return o(i),u()}case Qe.TEXT_MESSAGE_CHUNK:throw new Error("TEXT_MESSAGE_CHUNK must be tranformed before being applied");case Qe.TOOL_CALL_CHUNK:throw new Error("TOOL_CALL_CHUNK must be tranformed before being applied");case Qe.THINKING_START:case Qe.THINKING_END:case Qe.THINKING_TEXT_MESSAGE_START:case Qe.THINKING_TEXT_MESSAGE_CONTENT:case Qe.THINKING_TEXT_MESSAGE_END:return u()}return t.type,u()},ht(f)?gn(d,f,1):gn(d,1)),(void 0===c&&(c=1/0),gn(nn,c)),r.length>0?(l={},vt(function(e,t){var n=!1;e.subscribe(Wt(t,function(e){n=!0,t.next(e)},function(){n||t.next(l),t.complete()}))})):e=>e);var l,c,d,f})(e,t,this,n)}processApplyEvents(e,t,n){return t.pipe((i=ht(r=t=>{t.messages&&(this.messages=t.messages,n.forEach(t=>{var n;null==(n=t.onMessagesChanged)||n.call(t,{messages:this.messages,state:this.state,agent:this,input:e})})),t.state&&(this.state=t.state,n.forEach(t=>{var n;null==(n=t.onStateChanged)||n.call(t,{state:this.state,messages:this.messages,agent:this,input:e})}))})?{next:r,error:s,complete:a}:r)?vt(function(e,t){var n;null===(n=i.subscribe)||void 0===n||n.call(i);var r=!0;e.subscribe(Wt(t,function(e){var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},function(){var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},function(e){var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},function(){var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):nn);var r,s,a,i}prepareRunAgentInput(e){var t,n,r;return{threadId:this.threadId,runId:(null==e?void 0:e.runId)||ds(),tools:Ss(null!=(t=null==e?void 0:e.tools)?t:[]),context:Ss(null!=(n=null==e?void 0:e.context)?n:[]),forwardedProps:Ss(null!=(r=null==e?void 0:e.forwardedProps)?r:{}),state:Ss(this.state),messages:Ss(this.messages)}}async onInitialize(e,t){let n=await Ns(t,this.messages,this.state,(t,n,r)=>{var s;return null==(s=t.onRunInitialized)?void 0:s.call(t,{messages:n,state:r,agent:this,input:e})});(void 0!==n.messages||void 0!==n.state)&&(n.messages&&(this.messages=n.messages,e.messages=n.messages,t.forEach(t=>{var n;null==(n=t.onMessagesChanged)||n.call(t,{messages:this.messages,state:this.state,agent:this,input:e})})),n.state&&(this.state=n.state,e.state=n.state,t.forEach(t=>{var n;null==(n=t.onStateChanged)||n.call(t,{state:this.state,messages:this.messages,agent:this,input:e})})))}onError(e,t,n){return En(Ns(n,this.messages,this.state,(n,r,s)=>{var a;return null==(a=n.onRunFailed)?void 0:a.call(n,{error:t,messages:r,state:s,agent:this,input:e})})).pipe(Yt(r=>{let s=r;if((void 0!==s.messages||void 0!==s.state)&&(void 0!==s.messages&&(this.messages=s.messages,n.forEach(t=>{var n;null==(n=t.onMessagesChanged)||n.call(t,{messages:this.messages,state:this.state,agent:this,input:e})})),void 0!==s.state&&(this.state=s.state,n.forEach(t=>{var n;null==(n=t.onStateChanged)||n.call(t,{state:this.state,messages:this.messages,agent:this,input:e})}))),!0!==s.stopPropagation)throw console.error("Agent execution failed:",t),t;return{}}))}async onFinalize(e,t){let n=await Ns(t,this.messages,this.state,(t,n,r)=>{var s;return null==(s=t.onRunFinalized)?void 0:s.call(t,{messages:n,state:r,agent:this,input:e})});(void 0!==n.messages||void 0!==n.state)&&(void 0!==n.messages&&(this.messages=n.messages,t.forEach(t=>{var n;null==(n=t.onMessagesChanged)||n.call(t,{messages:this.messages,state:this.state,agent:this,input:e})})),void 0!==n.state&&(this.state=n.state,t.forEach(t=>{var n;null==(n=t.onStateChanged)||n.call(t,{state:this.state,messages:this.messages,agent:this,input:e})})))}clone(){let e=Object.create(Object.getPrototypeOf(this));for(let t of Object.getOwnPropertyNames(this)){let n=this[t];"function"!=typeof n&&(e[t]=Ss(n))}return e}addMessage(e){this.messages.push(e),(async()=>{var t,n,r;for(let n of this.subscribers)await(null==(t=n.onNewMessage)?void 0:t.call(n,{message:e,messages:this.messages,state:this.state,agent:this}));if("assistant"===e.role&&e.toolCalls)for(let t of e.toolCalls)for(let e of this.subscribers)await(null==(n=e.onNewToolCall)?void 0:n.call(e,{toolCall:t,messages:this.messages,state:this.state,agent:this}));for(let e of this.subscribers)await(null==(r=e.onMessagesChanged)?void 0:r.call(e,{messages:this.messages,state:this.state,agent:this}))})()}addMessages(e){this.messages.push(...e),(async()=>{var t,n,r;for(let r of e){for(let e of this.subscribers)await(null==(t=e.onNewMessage)?void 0:t.call(e,{message:r,messages:this.messages,state:this.state,agent:this}));if("assistant"===r.role&&r.toolCalls)for(let e of r.toolCalls)for(let t of this.subscribers)await(null==(n=t.onNewToolCall)?void 0:n.call(t,{toolCall:e,messages:this.messages,state:this.state,agent:this}))}for(let e of this.subscribers)await(null==(r=e.onMessagesChanged)?void 0:r.call(e,{messages:this.messages,state:this.state,agent:this}))})()}setMessages(e){this.messages=Ss(e),(async()=>{var e;for(let t of this.subscribers)await(null==(e=t.onMessagesChanged)?void 0:e.call(t,{messages:this.messages,state:this.state,agent:this}))})()}setState(e){this.state=Ss(e),(async()=>{var e;for(let t of this.subscribers)await(null==(e=t.onStateChanged)?void 0:e.call(t,{messages:this.messages,state:this.state,agent:this}))})()}legacy_to_be_removed_runAgentBridged(e){var t;this.agentId=null!=(t=this.agentId)?t:ds();let n=this.prepareRunAgentInput(e);return this.run(n).pipe(Os(this.debug),ks(this.debug),((e,t,n)=>r=>{let s={},a=!0,i=!0,o="",u=null,l=null,c=[],d={},f=e=>{"object"==typeof e&&null!==e&&("messages"in e&&delete e.messages,s=e)};return r.pipe(gn(r=>{switch(r.type){case Qe.TEXT_MESSAGE_START:{let e=r;return[{type:As.enum.TextMessageStart,messageId:e.messageId}]}case Qe.TEXT_MESSAGE_CONTENT:{let e=r;return[{type:As.enum.TextMessageContent,messageId:e.messageId,content:e.delta}]}case Qe.TEXT_MESSAGE_END:{let e=r;return[{type:As.enum.TextMessageEnd,messageId:e.messageId}]}case Qe.TOOL_CALL_START:{let e=r;return c.push({id:e.toolCallId,type:"function",function:{name:e.toolCallName,arguments:""}}),i=!0,d[e.toolCallId]=e.toolCallName,[{type:As.enum.ActionExecutionStart,actionExecutionId:e.toolCallId,actionName:e.toolCallName,parentMessageId:e.parentMessageId}]}case Qe.TOOL_CALL_ARGS:{let u=r,d=c[c.length-1];d.function.arguments+=u.delta;let p=!1;if(l){let e=l.find(e=>e.tool==d.function.name);if(e)try{let t=JSON.parse(tr(d.function.arguments));e.tool_argument&&e.tool_argument in t?(f(ws(Ts({},s),{[e.state_key]:t[e.tool_argument]})),p=!0):e.tool_argument||(f(ws(Ts({},s),{[e.state_key]:t})),p=!0)}catch(e){}}return[{type:As.enum.ActionExecutionArgs,actionExecutionId:u.toolCallId,args:u.delta},...p?[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(s),active:i}]:[]]}case Qe.TOOL_CALL_END:{let e=r;return[{type:As.enum.ActionExecutionEnd,actionExecutionId:e.toolCallId}]}case Qe.TOOL_CALL_RESULT:{let e=r;return[{type:As.enum.ActionExecutionResult,actionExecutionId:e.toolCallId,result:e.content,actionName:d[e.toolCallId]||"unknown"}]}case Qe.RAW:return[];case Qe.CUSTOM:{let e=r;switch(e.name){case"Exit":a=!1;break;case"PredictState":l=e.value}return[{type:As.enum.MetaEvent,name:e.name,value:e.value}]}case Qe.STATE_SNAPSHOT:return f(r.snapshot),[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(s),active:i}];case Qe.STATE_DELTA:{let u=Zn(s,r.delta,!0,!1);return u?(f(u.newDocument),[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(s),active:i}]):[]}case Qe.MESSAGES_SNAPSHOT:return u=r.messages,[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(Ts(Ts({},s),u?{messages:u}:{})),active:!0}];case Qe.RUN_STARTED:return[];case Qe.RUN_FINISHED:return u&&(s.messages=u),[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(Ts(Ts({},s),u?{messages:Cs(u)}:{})),active:!1}];case Qe.RUN_ERROR:return console.error("Run error",r),[];case Qe.STEP_STARTED:return o=r.stepName,c=[],l=null,[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(s),active:!0}];case Qe.STEP_FINISHED:return c=[],l=null,[{type:As.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:o,runId:t,running:a,role:"assistant",state:JSON.stringify(s),active:!1}];default:return[]}}))})(this.threadId,n.runId,this.agentId),e=>e.pipe(Yt(e=>(this.debug&&console.debug("[LEGACY]:",JSON.stringify(e)),e))))}};window.AGUIClient={HttpAgent:class extends xs{constructor(e){var t;super(e),this.abortController=new AbortController,this.url=e.url,this.headers=Ss(null!=(t=e.headers)?t:{})}requestInit(e){return{method:"POST",headers:ws(Ts({},this.headers),{"Content-Type":"application/json",Accept:"text/event-stream"}),body:JSON.stringify(e),signal:this.abortController.signal}}runAgent(e,t){var n;return this.abortController=null!=(n=null==e?void 0:e.abortController)?n:new AbortController,super.runAgent(e,t)}abortRun(){this.abortController.abort(),super.abortRun()}run(e){let t=(n=this.url,r=this.requestInit(e),(a=()=>En(fetch(n,r)),new sn(function(e){hn(a()).subscribe(e)})).pipe((s=e=>{var t;let n={type:"headers",status:e.status,headers:e.headers},r=null==(t=e.body)?void 0:t.getReader();return r?new sn(e=>(e.next(n),(async()=>{try{for(;;){let{done:t,value:n}=await r.read();if(t)break;let s={type:"data",data:n};e.next(s)}e.complete()}catch(t){e.error(t)}})(),()=>{r.cancel()})):nr(()=>new Error("Failed to getReader() from response"))},vt(function(e,t){var n=null,r=!1,a=function(){return r&&!n&&t.complete()};e.subscribe(Wt(t,function(e){null==n||n.unsubscribe(),hn(s(e)).subscribe(n=Wt(t,function(e){return t.next(e)},function(){n=null,a()}))},function(){r=!0,a()}))}))));var n,r,s,a;return(e=>{let t=new sr,n=new or,r=!1;return e.subscribe({next:e=>{n.next(e),"headers"!==e.type||r?r||t.error(new Error("No headers event received before data events")):(r=!0,"application/vnd.ag-ui.event+proto"===e.headers.get("content-type")?(e=>{let t=new sr,n=new Uint8Array(0);function r(){for(;n.length>=4;){let e=4+new DataView(n.buffer,n.byteOffset,4).getUint32(0,!1);if(n.length<e)break;try{let r=is(n.slice(4,e));t.next(r),n=n.slice(e)}catch(e){let n=e instanceof Error?e.message:String(e);return void t.error(new Error(`Failed to decode protocol buffer message: ${n}`))}}}return e.subscribe({next:e=>{if("headers"!==e.type&&"data"===e.type&&e.data){let t=new Uint8Array(n.length+e.data.length);t.set(n,0),t.set(e.data,n.length),n=t,r()}},error:e=>t.error(e),complete:()=>{if(n.length>0)try{r()}catch(e){console.warn("Incomplete or invalid protocol buffer data at stream end")}t.complete()}}),t.asObservable()})(n).subscribe({next:e=>t.next(e),error:e=>t.error(e),complete:()=>t.complete()}):(e=>{let t=new sr,n=new TextDecoder("utf-8",{fatal:!1}),r="";function s(e){let n=e.split("\n"),r=[];for(let e of n)e.startsWith("data: ")&&r.push(e.slice(6));if(r.length>0)try{let e=r.join("\n"),n=JSON.parse(e);t.next(n)}catch(e){t.error(e)}}return e.subscribe({next:e=>{if("headers"!==e.type&&"data"===e.type&&e.data){let t=n.decode(e.data,{stream:!0});r+=t;let a=r.split(/\n\n/);r=a.pop()||"";for(let e of a)s(e)}},error:e=>t.error(e),complete:()=>{r&&(r+=n.decode(),s(r)),t.complete()}}),t.asObservable()})(n).subscribe({next:e=>{try{let n=pt.parse(e);t.next(n)}catch(e){t.error(e)}},error:e=>t.error(e),complete:()=>t.complete()}))},error:e=>{n.error(e),t.error(e)},complete:()=>{n.complete()}}),t.asObservable()})(t)}}},console.log("AG-UI Client loaded:",window.AGUIClient)})();